<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-other/umi.css" />
    <script>
      window.routerBase = "/blog-other";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>12｜深度学习（中）：如何用RNN预测激活率走势？ - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/零基础实战机器学习/03.业务场景闯关篇/08" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-other/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>前端开发<ul><li><a href="/blog-other/说透低代码">说透低代码</a></li><li><a href="/blog-other/反爬虫兵法演绎20讲">反爬虫兵法演绎20讲</a></li></ul></span><span>产品与用户体验<ul><li><a href="/blog-other/大厂广告产品心法">大厂广告产品心法</a></li></ul></span><span>面试<ul><li><a href="/blog-other/技术面试官识人手册">技术面试官识人手册</a></li><li><a href="/blog-other/面试现场">面试现场</a></li></ul></span><span>杂谈<ul><li><a href="/blog-other/乔新亮的cto成长复盘">乔新亮的cto成长复盘</a></li><li><a href="/blog-other/互联网人的英语私教课">互联网人的英语私教课</a></li><li><a href="/blog-other/从0开始学游戏开发">从0开始学游戏开发</a></li><li><a href="/blog-other/全栈工程师修炼指南">全栈工程师修炼指南</a></li><li><a href="/blog-other/手机摄影">手机摄影</a></li><li><a href="/blog-other/物联网开发实战">物联网开发实战</a></li><li><a href="/blog-other/白话法律42讲">白话法律42讲</a></li><li><a href="/blog-other/说透5g">说透5g</a></li><li><a href="/blog-other/超级访谈对话张雪峰">超级访谈对话张雪峰</a></li><li><a aria-current="page" class="active" href="/blog-other/零基础实战机器学习">零基础实战机器学习</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-other/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>前端开发<ul><li><a href="/blog-other/说透低代码">说透低代码</a></li><li><a href="/blog-other/反爬虫兵法演绎20讲">反爬虫兵法演绎20讲</a></li></ul></li><li>产品与用户体验<ul><li><a href="/blog-other/大厂广告产品心法">大厂广告产品心法</a></li></ul></li><li>面试<ul><li><a href="/blog-other/技术面试官识人手册">技术面试官识人手册</a></li><li><a href="/blog-other/面试现场">面试现场</a></li></ul></li><li>杂谈<ul><li><a href="/blog-other/乔新亮的cto成长复盘">乔新亮的cto成长复盘</a></li><li><a href="/blog-other/互联网人的英语私教课">互联网人的英语私教课</a></li><li><a href="/blog-other/从0开始学游戏开发">从0开始学游戏开发</a></li><li><a href="/blog-other/全栈工程师修炼指南">全栈工程师修炼指南</a></li><li><a href="/blog-other/手机摄影">手机摄影</a></li><li><a href="/blog-other/物联网开发实战">物联网开发实战</a></li><li><a href="/blog-other/白话法律42讲">白话法律42讲</a></li><li><a href="/blog-other/说透5g">说透5g</a></li><li><a href="/blog-other/超级访谈对话张雪峰">超级访谈对话张雪峰</a></li><li><a aria-current="page" class="active" href="/blog-other/零基础实战机器学习">零基础实战机器学习</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-other/零基础实战机器学习">零基础实战机器学习</a></li><li><a href="/blog-other/零基础实战机器学习/01.开篇词">01.开篇词</a><ul><li><a href="/blog-other/零基础实战机器学习/01.开篇词/01"><span>开篇词｜开发者为什么要从实战出发学机器学习？</span></a></li></ul></li><li><a href="/blog-other/零基础实战机器学习/02.准备篇">02.准备篇</a><ul><li><a href="/blog-other/零基础实战机器学习/02.准备篇/01"><span>01｜打好基础：到底什么是机器学习？</span></a></li><li><a href="/blog-other/零基础实战机器学习/02.准备篇/02"><span>02｜工具准备：安装并使用Jupyter Notebook</span></a></li><li><a href="/blog-other/零基础实战机器学习/02.准备篇/03"><span>03｜实战5步（上）：怎么定义问题和预处理数据？</span></a></li><li><a href="/blog-other/零基础实战机器学习/02.准备篇/04"><span>04｜ 实战5步（下）：怎么建立估计10万+软文点击率的模型？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇">03.业务场景闯关篇</a><ul><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/01"><span>05 | 数据探索：怎样从数据中找到用户的RFM值？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/02"><span>06 | 聚类分析：如何用RFM给电商用户做价值分组画像？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/03"><span>07｜回归分析：怎样用模型预测用户的生命周期价值？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/04"><span>08 | 模型优化（上）：怎么用特征工程提高模型效率？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/05"><span>09｜模型优化（中）：防止过拟合，模型也不能太精细</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/06"><span>10｜模型优化（下）：交叉验证，同时寻找最优的参数</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/07"><span>11｜深度学习（上）：用CNN带你认识深度学习</span></a></li><li><a aria-current="page" class="active" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08"><span>12｜深度学习（中）：如何用RNN预测激活率走势？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/09"><span>13｜深度学习（下）：3招提升神经网络预测准确率</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/10"><span>14｜留存分析：哪些因素会影响用户的留存率？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/11"><span>15｜二元分类：怎么预测用户是否流失？从逻辑回归到深度学习</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/12"><span>16｜性能评估：不平衡数据集应该使用何种评估指标？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/13"><span>17｜集成学习：机器学习模型如何“博采众长”?</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/14"><span>18 | 增长模型：用XGBoost评估裂变海报的最佳受众群体</span></a></li></ul></li><li><a href="/blog-other/零基础实战机器学习/04.持续赋能篇">04.持续赋能篇</a><ul><li><a href="/blog-other/零基础实战机器学习/04.持续赋能篇/01"><span>19 | 胸有成竹：如何快速定位合适的机器学习算法？</span></a></li><li><a href="/blog-other/零基础实战机器学习/04.持续赋能篇/02"><span>20 | 模型部署：怎么发布训练好的机器学习模型？</span></a></li><li><a href="/blog-other/零基础实战机器学习/04.持续赋能篇/03"><span>21｜持续精进：如何在机器学习领域中找准前进的方向？</span></a></li></ul></li><li><a href="/blog-other/零基础实战机器学习/05.结束语">05.结束语</a><ul><li><a href="/blog-other/零基础实战机器学习/05.结束语/01"><span>一套习题，测出你对机器学习的掌握程度</span></a></li><li><a href="/blog-other/零基础实战机器学习/05.结束语/02"><span>结束语 | 可以不完美，但重要的是马上开始</span></a></li></ul></li><li><a href="/blog-other/零基础实战机器学习/summary">零基础实战机器学习</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="定义问题" data-depth="2"><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#定义问题"><span>定义问题</span></a></li><li title="收集数据和预处理" data-depth="2"><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#收集数据和预处理"><span>收集数据和预处理</span></a></li><li title="1. 数据可视化" data-depth="3"><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#1-数据可视化"><span>1. 数据可视化</span></a></li><li title="2. 数据清洗" data-depth="3"><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#2-数据清洗"><span>2. 数据清洗</span></a></li><li title="3. 拆分训练集和测试集" data-depth="3"><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#3-拆分训练集和测试集"><span>3. 拆分训练集和测试集</span></a></li><li title="4. 特征工程" data-depth="3"><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#4-特征工程"><span>4. 特征工程</span></a></li><li title="5. 构建特征集和标签集" data-depth="3"><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#5-构建特征集和标签集"><span>5. 构建特征集和标签集</span></a></li><li title="选择算法并建立模型" data-depth="2"><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#选择算法并建立模型"><span>选择算法并建立模型</span></a></li><li title="训练并评估模型" data-depth="2"><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#训练并评估模型"><span>训练并评估模型</span></a></li><li title="利用模型进行预测" data-depth="2"><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#利用模型进行预测"><span>利用模型进行预测</span></a></li><li title="总结一下" data-depth="2"><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#总结一下"><span>总结一下</span></a></li><li title="思考题" data-depth="2"><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#思考题"><span>思考题</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="12深度学习中如何用rnn预测激活率走势"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#12深度学习中如何用rnn预测激活率走势"><span class="icon icon-link"></span></a>12｜深度学习（中）：如何用RNN预测激活率走势？</h1><p>你好，我是黄佳。</p><p>欢迎来到零基础实战机器学习。在上一讲中，我们通过给鲜花图片分类，学习了CNN在图像识别方面的应用。这一讲呢，我们就来学习另外一种深度学习模型——循环神经网络RNN（Recurrent Neural Network）。那么进入正题之前，我先给你讲个段子，让你直观理解一下，循环神经网络和其它神经网络模型有啥不同。</p><p>假如我和你开车去商场，然后我说“嘿！你知道吗，昨天老王的夫人生二胎了！”你说：“是吗？这么大年纪，真不容易。对了，上次你说他的项目没上线，对吧，后来那个项目到底怎么样了呢？”我回答说：“嗨，那个项目啊，别提了，把他整惨了，三次上线都失败了，现在公司在考虑放弃老王负责的这个项目。嗯，到了，你等我一会儿，我去给老王买个_____（此处为填空，选项1：项目；选项2：玩具）慰问一下他。”</p><p>若是这个选择题给循环神经网络之外的其它神经网络做，我们得到的答案可能是“项目”，因为在输入的文本（特征）中，一直是在谈项目，可正确答案显然是“玩具”。也就是说，如果让神经网络实现类似于人脑的语义判别能力，有一个很重要的前提是，<strong>必须从所有过去的句子中保留一些信息，以便能理解整个故事的上下文</strong>。而循环神经网络中的记忆功能恰恰解决了这个“对前文的记忆”功能。</p><p>而这种对前文记忆的功能，让循环神经网络特别适合处理自然语言、文本和时间序列这种“新内容依赖于上下文或者历史信息”的数据。</p><p>好，明白了这一点，现在我们来看看这节课要解决的问题吧！</p><h2 id="定义问题"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#定义问题"><span class="icon icon-link"></span></a>定义问题</h2><p>今天这个项目的业务场景非常简单：易速鲜花App从2019年上线以来，App的日激活数稳步增长。运营团队已经拉出两年以来每天的具体激活数字，现在要交给你的任务是，建立起一个能够预测未来激活率走势的机器学习模型。</p><p><img src="data:image/png;base64,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" alt=""/></p><p>你可以在<a target="_blank" rel="noopener noreferrer" href="https://www.kaggle.com/tohuangjia/flower-app">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>下载这个数据集，或者就基于这个数据集，在Kaggle网站上创建新的Notebook。<a target="_blank" rel="noopener noreferrer" href="https://www.kaggle.com/tohuangjia/rnn-network">代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>呢，我把它发布在<a target="_blank" rel="noopener noreferrer" href="https://www.kaggle.com/tohuangjia/rnn-network">Kaggle<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>网站，你也可以Copy &amp; Edit它到自己的Notebook。</p><p>看到这个数据集，你可能会觉得和之前的数据集不太一样了，它的字段特别少，只有两个。现在，我给你几秒钟思考一下，这个数据集的特征和标签分别是什么？你可能会说，标签比较容易找，因为要预测激活数，所以“激活数”就是标签。</p><p>你可能还会进一步分析说，从机器学习的类型来看，这里我们有要预测的标签，所以它是一个监督学习问题，而且，标签是连续性的数值，因此它是一个回归问题。</p><p>这些都没错，不过，特征在哪里呢？难道说，“日期”字段就是这个数据集的特征吗？这些日期看起来像是普普通通的编号，它既不是有意义的值（比如分数），也不是分类的类别编码（比如男生/女生），难道机器学习模型这么厉害，输入这样的编号，就能够预测出未来的App激活数？</p><p>而且，如果你回忆一下我们之前见过的那些数据集，就会发现特征和标签之间会呈现出一种相关性。比如说点赞数、转发数多的时候，往往浏览量也多。但是，在这个数据集中，日期和App的激活数之间是不存在这种相关性的。所以，日期并不是一个合适的特征。</p><p>不过，在这个数据集中，“日期”仍然是非常重要的信息。让我们一起来回顾一下这个问题的目标：本质上，我们是希望从过去的状态中，找到蛛丝马迹，来预测未来的状态。而过去的状态，肯定是和日期相关联的。</p><p>所以，我们可以这样来构建这个数据集的特征：从当前要预测的日期开始，假如是2020年6月30日，我们回推60天，拥有从2020年5月1日到2020年6月29日这60天的激活数历史数值。那么，如果我们把这些历史数值都做为特征，输入机器学习。并且，我们有理由相信，2020年6月30日往后的激活数与前60天的激活数有很强的相关性。根据这样的特征数据，机器就可以学习到一条预测激活数的趋势线了。</p><p>其实，像这样和日期、时间相关的，并且以连续性数值为特征的数据集，就叫做<strong>时间序列数据</strong>，简称<strong>时序数据</strong>。典型的时序数据包括股票价格、点击数、产品销售数量等等。</p><p>那到这里呢，我们就已经把问题定义好了，数据也有了，紧接着下一步就是数据的预处理。</p><h2 id="收集数据和预处理"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#收集数据和预处理"><span class="icon icon-link"></span></a>收集数据和预处理</h2><h3 id="1-数据可视化"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#1-数据可视化"><span class="icon icon-link"></span></a>1. 数据可视化</h3><p>我们先把数据集导入程序。其中parse_dates=[‘Date’]是把Date字段以日期格式导入。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">import numpy as np #导入NumPy</span></div><div class="token-line"><span class="token plain">    import pandas as pd #导入Pandas </span></div><div class="token-line"><span class="token plain">    df_app = pd.read_csv(&#x27;app.csv&#x27;, index_col=&#x27;Date&#x27;, parse_dates=[&#x27;Date&#x27;]) #导入数据</span></div><div class="token-line"><span class="token plain">    df_app #显示数据</span></div></pre></div><p>输出如下：</p><p><img src="data:image/png;base64,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" alt=""/></p><p>对于时间序列数据，可视化是相当有必要的。我们用plot这个API，绘制出激活数的历史走势图，其中时间为横坐标，App激活数为纵坐标的图像：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">import matplotlib.pyplot as plt #导入matplotlib.pyplot</span></div><div class="token-line"><span class="token plain">    plt.style.use(&#x27;fivethirtyeight&#x27;) #设定绘图风格</span></div><div class="token-line"><span class="token plain">    df_app[&quot;Activation&quot;].plot(figsize=(12,4),legend=True) #绘制激活数</span></div><div class="token-line"><span class="token plain">    plt.title(&#x27;App Activation Count&#x27;) #图题</span></div><div class="token-line"><span class="token plain">    plt.show() #绘图</span></div></pre></div><p>这里需要注意的是，我通过语句plt.style.use(‘fivethirtyeight’)设定了图像的风格。这种风格是从<a target="_blank" rel="noopener noreferrer" href="https://fivethirtyeight.com/">538网站<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（一个对各种事件和趋势进行预测的网站）的画风中移植过来的，很适合展示时序数据。</p><p>输出如下：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage8ab78abaafa09017781766e3d5bc7bda85b7.ff361195.png" alt=""/></p><p>看得出，自APP上线以来，日激活数整体呈上升的走势。从函数图像上看，也没有任何缺失的数据点。下面我们再来看看这个数据集是否需要做数据清洗工作。</p><h3 id="2-数据清洗"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#2-数据清洗"><span class="icon icon-link"></span></a>2. 数据清洗</h3><p>我们可以用下面这个语句看看有没有NaN值：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">df_app.isna().sum() #有NaN吗？</span></div></pre></div><p>结果显示数据集中没有NaN值。</p><p>对于App激活数，我只想保证数据集里全部都是正值，所以，可以用下面的语句查看有没有负值和零值：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">(df_app.Activation &lt; 0).values.any() #有负值吗？</span></div></pre></div><p>其中，values.any()这个API表示，只要Orders字段中有任意一个值是负值或者零值，就会返回True。</p><p>输出如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">False</span></div></pre></div><p>说明整个数据集没有一个0值或者负值。那我们也不需要做任何的清洗工作了。接下来，我们进入直接训练集和测试集的拆分。</p><h3 id="3-拆分训练集和测试集"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#3-拆分训练集和测试集"><span class="icon icon-link"></span></a>3. 拆分训练集和测试集</h3><p>我们假设以2020年10月1日为界，只给模型读入2020年10月1日之前的数据，之后的数据留作对模型的测试。那么，我们就以2020年10月1日为界，来拆分训练集和测试集：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain"># 按照2020年10月1日为界拆分数据集</span></div><div class="token-line"><span class="token plain">    Train = df_app[:&#x27;2020-09-30&#x27;].iloc[:,0:1].values #训练集</span></div><div class="token-line"><span class="token plain">    Test = df_app[&#x27;2020-10-01&#x27;:].iloc[:,0:1].values #测试集</span></div></pre></div><p>对于这段代码，我解释几点：</p><ul><li>df_app[:‘2020-09-30’]代表10月1日之前的数据，用于训练模型；df_app[‘2020-10-01’:]代表10月1日之后，用于对训练好的模型进行测试。</li><li>代码中的iloc属性，是Pandas中对DataFrame对象以行和列位置为索引抽取数据。其中的第一个参数代表行索引，指定“:”就表示抽取所有行；而第二个参数中的“0:1”代表要抽取的列索引的位置为第2列，也就是“激活数”这一列。</li><li>最后，.values这个属性就把Pandas对象转换成了Numpy数组，我们在<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/420372">上一讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中说过，机器学习中也把Numpy数组称为张量，神经网络模型需要Numpy张量类型作为输入。</li></ul><p>这时候，如果我们显示这个数据对象Train，就会发现它已经成为了一个NumPy数组：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">Train #显示训练集对象</span></div></pre></div><p>输出如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">array([[419],</span></div><div class="token-line"><span class="token plain">           [432],</span></div><div class="token-line"><span class="token plain">           ...</span></div><div class="token-line"><span class="token plain">           [872],</span></div><div class="token-line"><span class="token plain">           [875]])</span></div></pre></div><p>对于神经网络来说，输入的张量形状非常重要，我们要显式指明输入维度，绝不能错，所以我们要经常用NumPy中的.shape属性查看当前数据对象的形状。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">print(&#x27;训练集的形状是：&#x27;, Train.shape)</span></div><div class="token-line"><span class="token plain">    print(&#x27;测试集的形状是：&#x27;, Test.shape)</span></div></pre></div><p>输出如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">训练集的形状是： (639, 1)</span></div><div class="token-line"><span class="token plain">    测试集的形状是： (117, 1)</span></div></pre></div><p>目前，训练集是639行的一维数组，测试集是117行的一维数组，但它们都是二阶张量。</p><p>为了直观地显示拆分，我们可以把原始数据集按照拆分日期用不同颜色进行显示。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain"># 以不同颜色为训练集和测试集绘图</span></div><div class="token-line"><span class="token plain">    df_app[&quot;Activation&quot;][:&#x27;2020-09-30&#x27;].plot(figsize=(12,4),legend=True) #训练集</span></div><div class="token-line"><span class="token plain">    df_app[&quot;Activation&quot;][&#x27;2020-10-01&#x27;:].plot(figsize=(12,4),legend=True) #测试集</span></div><div class="token-line"><span class="token plain">    plt.legend([&#x27;Training set (Before October 2020)&#x27;,&#x27;Test set (2020 October and beyond)&#x27;]) #图例</span></div><div class="token-line"><span class="token plain">    plt.title(&#x27;App Activation Count&#x27;) #图题</span></div><div class="token-line"><span class="token plain">    plt.show() #绘图</span></div></pre></div><p>输出如下：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimagefbfbfb1fd22eb1a4ac3c8445231c729346fb.807cd0bb.png" alt=""/></p><p>好啦，拆分出训练集和测试集后，下面我们做特征工程。</p><h3 id="4-特征工程"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#4-特征工程"><span class="icon icon-link"></span></a>4. 特征工程</h3><p>对于神经网络来说，这是一个特别重要的步骤。我们上节课说过，神经网络非常不喜欢数值跨度大的数据，所以，我们对训练特征数据集进行归一化缩放。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">from sklearn.preprocessing import MinMaxScaler #导入归一化缩放器</span></div><div class="token-line"><span class="token plain">    Scaler = MinMaxScaler(feature_range=(0,1)) #创建缩放器</span></div><div class="token-line"><span class="token plain">    Train = Scaler.fit_transform(Train) #拟合缩放器并对训练集进行归一化</span></div></pre></div><p>归一化完成之后，我们来做最后一个数据预处理的步骤：构建特征集和标签集。</p><h3 id="5-构建特征集和标签集"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#5-构建特征集和标签集"><span class="icon icon-link"></span></a>5. 构建特征集和标签集</h3><p>我们前面说过，这个数据集的标签就是App激活数，特征是时序数据。如果我们要预测今天的App下载数量，那时序数据特征的典型构造方法就是，把之前30天或者60天的App下载数量作为特征信息被输入机器学习模型。</p><p>所以，在下面的这段代码中，我们创建了一个具有 60 个时间步长（所谓步长，就是时间相关的历史特征数据点）和 1 个输出的数据结构。对于训练集的每一行，我们有 60 个之前的App下载数作为特征，1个当前训练集元素作为标签。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain"># 创建具有 60 个时间步长和 1 个输出的数据结构 - 训练集</span></div><div class="token-line"><span class="token plain">    X_train = [] #初始化</span></div><div class="token-line"><span class="token plain">    y_train = [] #初始化</span></div><div class="token-line"><span class="token plain">    for i in range(60,Train.size): </span></div><div class="token-line"><span class="token plain">        X_train.append(Train[i-60:i,0]) #构建特征</span></div><div class="token-line"><span class="token plain">        y_train.append(Train[i,0]) #构建标签</span></div><div class="token-line"><span class="token plain">    X_train, y_train = np.array(X_train), np.array(y_train) #转换为NumPy数组</span></div><div class="token-line"><span class="token plain">    X_train = np.reshape(X_train, (X_train.shape[0],X_train.shape[1],1)) #转换成神经网络所需的张量形状</span></div></pre></div><p>在这个过程中的最后一步，我是用NumPy中的reshape方法，把特征数据集转换成神经网络所需要的形状的。我之所以强调这一点，是因为如果形状不对，程序在训练时就会报错，这个错误对初学者来说很常见。</p><p>这里我显示一下目前X_train集的形状：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">X_train.shape #X_train的形状</span></div></pre></div><p>输出如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">X_train的形状是： (579, 60, 1)</span></div></pre></div><p>输出显示它是一个三阶张量，每一阶上面的维度是579（579行数据）、60（每一个当日激活数往前60天的激活数）和1（每一个时间点只有激活数一个特征）。</p><p>我们用同样的方法构建测试集：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">TrainTest = df_app[&quot;Activation&quot;][:] #整体数据</span></div><div class="token-line"><span class="token plain">    inputs = TrainTest[len(TrainTest)-len(Test) - 60:].values #Test加上前60个时间步</span></div><div class="token-line"><span class="token plain">    inputs = inputs.reshape(-1,1) #转换形状</span></div><div class="token-line"><span class="token plain">    inputs  = Scaler.transform(inputs) #归一化</span></div><div class="token-line"><span class="token plain">    # 创建具有 60 个时间步长和 1 个输出的数据结构 - 测试集</span></div><div class="token-line"><span class="token plain">    X_test = [] #初始化</span></div><div class="token-line"><span class="token plain">    y_test = [] #初始化</span></div><div class="token-line"><span class="token plain">    for i in range(60,inputs.size): </span></div><div class="token-line"><span class="token plain">        X_test.append(inputs[i-60:i,0]) #构建特征</span></div><div class="token-line"><span class="token plain">        y_test.append(inputs[i,0]) #构建标签</span></div><div class="token-line"><span class="token plain">    X_test = np.array(X_test) #转换为NumPy数组</span></div><div class="token-line"><span class="token plain">    X_test = np.reshape(X_test, (X_test.shape[0],X_test.shape[1],1)) #转换成神经网络所需的张量形状</span></div></pre></div><p>如果我们显示测试集的形状，会发现它是形状为(117, 60, 1)的张量。</p><p>好啦，至此，数据预处理的工作就终于完成了。我们进入到下一个环节：选择算法，创建模型。</p><h2 id="选择算法并建立模型"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#选择算法并建立模型"><span class="icon icon-link"></span></a>选择算法并建立模型</h2><p>前面我已经给你剧透了，对于预测App未来激活数的问题，我们会选择神经网络中的RNN。其实，我们可选的算法还是挺多的，比如说普通的回归算法，还有像AR（自回归）、MA（滑动平均）、ARMA（自回归滑动平均）、ARIMA（差分自回归滑动平均）等专门处理时序数据的模型，还有Facebook发布的Prophect算法，也可以用于时间序列的预测。</p><p>当然，最为高效、最常用的时序预测模型，仍然莫过于深度学习中的RNN了。这也是我们这次实战中会选用RNN模型。那么，为什么RNN擅长时序数据的处理呢？这里我们就要多说两句它的原理了。</p><p>我们知道，循环神经网络是神经网络的一种，不过，和其它类型的神经网络相比，最大的不同是它建立了自身的记忆机制，增加了时间相关的状态信息在各层神经元间的循环传递机制。即一个序列的当前输出与前面各个神经元的输出也是有关的，即隐藏层之间不再是不相连的，而是有连接的。这就让循环神经网络能够更加自由和动态地获取输入的信息，而不受到定长输入空间的限制。</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage78y778189a848e83facdf0dc641ec66c0yy7.5226e57e.png" alt="" title="循环神经网络建立了与时间状态相关的记忆机制"/></p><p>因此，向循环神经网络中输入的数据都有这样的特点， 数据集中不仅要包含当前的特征值，还要包括前一刻或者前几刻的状态。</p><p>循环神经网络的应用场景正是这种有“上下文历史”的数据，比如说我们文章开头说的那个给老王买礼物的例子，那其实是在对自然语言处理。再比如视频处理，当前帧中发生的事情在很大程度上取决于之前数帧中的内容。另外，还有一个典型的应用场景就是我们这里的实战案例，循环神经网络要处理的是一个典型的时间序列分析数据集，根据前面60天的激活数，对未来的数字进行预测。</p><p>你会发现，这些场景和数据集，都有一个显著的特点，就是要预测的内容，和之前一段时间的特征值密切相关，就适合选择循环神经网络来建立模型进行处理。</p><p>到这里，你应该理解了为什么我们的时序数据预测要用RNN来处理，现在，我们就来考虑怎么搭建RNN。</p><p>在Kares中，主要有三种循环神经网络层可以搭建循环神经网络，分别是Simple RNN、LSTM和GRU，那我们该选哪一个呢？我们来做个甄别。</p><p>Simple RNN，顾名思义，就是最简单的循环神经网络结构，它的结构如下图所示。这个结构比较简单，只是在输入特征X的基础之上加入了$h_<!-- -->{<!-- -->t<!-- -->}<!-- -->$这个时间状态信息，也就是“记忆”功能。</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage7bf07b5b14a9f68dfe7ce36d8d981269aef0.190050a8.jpg" alt="" title="Simple RNN神经元结构"/></p><p>不过这种结构有一个缺陷，就是会出现“短期记忆的问题”。我们知道，神经网络在训练的过程中，参数是从后面的层向前面的层反向传播的，同时还会在每一步计算梯度，做梯度下降，用于更新神经网络中的权重。</p><p>如果前一层对当前层的影响很小，那么梯度值就会很小，反之亦然。如果前一层的梯度很小，那么当前层的梯度会更小。这就使得梯度在我们反向传播时呈指数缩小。而较小的梯度意味着它不会影响权重更新。所以，对于Simple RNN来说，较早期输入的信息对预测判断的影响会比较小，这就是我们前面说的“短期记忆问题”。</p><p>对于我们这个项目的数据集来说，时间跨度比较大，Simple RNN是很难捕捉到这种长期的时间关联的。</p><p>不过，LSTM（Long Short-Term Memory，长短期记忆网络）可以很好地解决这个问题。LSTM的神经元由一个遗忘门、一个输入门、一个输出门和一个记忆细胞组成，来记录额外的信息。记忆细胞负责记住时间相关的信息，而三个门负责调节进出神经元的信息流。这个过程中的数学原理我们这里不详述，你只需了解在这个过程中，每个记忆单元可获得连续的梯度流，能学习数百个时间步长的序列而误差保持原值，从而解决梯度消失问题。</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage0ea90e776737ea64ede63bd0e8ecd7f6e1a9.311abfa8.png" alt="" title="LSTM神经元结构"/></p><p>所以说，LSTM网络可以弥补Simple RNN对较长时期前历史信息相对不敏感的缺陷，它也被称为“穿越时空的旅程”，它的这种结构非常适合处理时间序列数据。</p><p>那么GRU呢？它适不适合我们这个项目呢？其实，GRU也是为了解决Simple RNN的短期记忆问题，它的复杂性介于Simple RNN和LSTM之间，在结构上要比LSTM简单一些。这里你只需要理解GRU是速度和性能的折衷选择就行。</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimagecf9bcfb58909c2379995800968e4f0084c9b.acbdd8d8.jpg" alt="" title="GRU神经元结构"/></p><p>对于预测App激活数走势这个项目来说，如果仅从性能角度考虑，那LSTM是最理想的，所以，我们就构建一个以LSTM为主要层结构的循环神经网络：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">from tensorflow.keras.models import Sequential #导入序贯模型</span></div><div class="token-line"><span class="token plain">    from tensorflow.keras.layers import Dense, LSTM #导入全连接层和LSTM层</span></div><div class="token-line"><span class="token plain">    # LSTM网络架构</span></div><div class="token-line"><span class="token plain">    RNN_LSTM = Sequential() #序贯模型</span></div><div class="token-line"><span class="token plain">    RNN_LSTM.add(LSTM(units=50, return_sequences=True, input_shape=(X_train.shape[1],1))) #输入层LSTM,return_sequences返回输出序列</span></div><div class="token-line"><span class="token plain">    RNN_LSTM.add(LSTM(units=50, return_sequences=True)) #中间1层LSTM，return_sequences返回输出序列</span></div><div class="token-line"><span class="token plain">    RNN_LSTM.add(LSTM(units=50, return_sequences=True)) #中间2层LSTM，return_sequences返回输出序列</span></div><div class="token-line"><span class="token plain">    RNN_LSTM.add(LSTM(units=50)) #中间3层LSTM</span></div><div class="token-line"><span class="token plain">    RNN_LSTM.add(Dense(units=1)) #输出层Dense</span></div><div class="token-line"><span class="token plain">    # 编译网络</span></div><div class="token-line"><span class="token plain">    RNN_LSTM.compile(loss=&#x27;mean_squared_error&#x27;, #损失函数</span></div><div class="token-line"><span class="token plain">                     optimizer=&#x27;rmsprop&#x27;, #优化器</span></div><div class="token-line"><span class="token plain">                     metrics=[&#x27;mae&#x27;]) #评估指标</span></div><div class="token-line"><span class="token plain">    RNN_LSTM.summary() #输出神经网络结构信息</span></div></pre></div><p>这个神经网络的结构如下所示：</p><p><img src="data:image/png;base64,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" alt=""/></p><p>到这里呢，我们就搭建好了合适的循环神经网络模型，搭建的过程和上一讲中搭建CNN的方法非常相似。接下来，我们开始做模型训练。</p><h2 id="训练并评估模型"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#训练并评估模型"><span class="icon icon-link"></span></a>训练并评估模型</h2><p>这里我们训练50次，并在训练的同时进行80/20比例的数据验证：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">history = regressor.fit(X_train, y_train, epochs=50, validation_split=0.2) # 训练并保存训练历史信息</span></div></pre></div><p>输出如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">Epoch 1/50</span></div><div class="token-line"><span class="token plain">    15/15 [==============================] - 11s 258ms/step - loss: 0.0813 - val_loss: 0.0640</span></div><div class="token-line"><span class="token plain">    Epoch 2/50</span></div><div class="token-line"><span class="token plain">    15/15 [==============================] - 2s 122ms/step - loss: 0.0101 - val_loss: 0.0511</span></div><div class="token-line"><span class="token plain">    Epoch 3/50</span></div><div class="token-line"><span class="token plain">    15/15 [==============================] - 2s 117ms/step - loss: 0.0125 - val_loss: 0.0064</span></div><div class="token-line"><span class="token plain">    ... ....</span></div><div class="token-line"><span class="token plain">    Epoch 48/50</span></div><div class="token-line"><span class="token plain">    15/15 [==============================] - 2s 118ms/step - loss: 0.0056 - val_loss: 0.0084</span></div><div class="token-line"><span class="token plain">    Epoch 49/50</span></div><div class="token-line"><span class="token plain">    15/15 [==============================] - 2s 121ms/step - loss: 0.0033 - val_loss: 0.0367</span></div><div class="token-line"><span class="token plain">    Epoch 50/50</span></div><div class="token-line"><span class="token plain">    15/15 [==============================] - 2s 119ms/step - loss: 0.0036 - val_loss: 0.0151</span></div></pre></div><p>由于这是一个回归值的预测问题，没有分类准确率指标，仅有损失值这个指标，我们就用<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/420372">上一讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中说过的损失曲线来显示训练过程中损失值的变化：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage47e1479a41e5a4bba451f1c7a65a246bb5e1.8b0afffc.png" alt=""/></p><p>可以看到，训练50轮之后，训练集上的损失已经很小了。不过，测试集上面的损失存在着振荡上升现象，这也是过拟合的一个标志。</p><h2 id="利用模型进行预测"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#利用模型进行预测"><span class="icon icon-link"></span></a>利用模型进行预测</h2><p>好啦，现在模型有了，评估也结束了，现在我们就来到了最令人激动的环节，让我们用模型预测一下测试集（也就是代表着未来）的激活数吧。不过，在预测结束之后，需要用inverse_transform对预测值做反归一化。否则，激活数将是一个0-1之间的值。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">predicted_stock_price = regressor.predict(X_test) #预测</span></div><div class="token-line"><span class="token plain">    predicted_stock_price = sc.inverse_transform(predicted_stock_price) #反归一化</span></div><div class="token-line"><span class="token plain">    plot_predictions(test_set,predicted_stock_price) #绘图</span></div></pre></div><p>输出如下：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimagea9faa9b4e7e27d297fd33fa85f5caea67afa.e3eda1ee.png" alt=""/></p><p>看得出来，我们的回归曲线和实际曲线的走势是相当接近的。不过，这个模型是否有进一步优化的可能，这个问题我们下一讲继续探讨。那到这里，我们的App激活率走势预测的任务就顺利结束了。</p><h2 id="总结一下"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#总结一下"><span class="icon icon-link"></span></a>总结一下</h2><p>现在，我们来回顾一下重点内容。</p><p>在这一讲中， 我们介绍了时间序列数据，以及善于处理时间序列数据集的循环神经网络算法RNN。RNN和其它类型的神经网络相比，它的特点是建立了自身的记忆机制，善于根据历史信息预测后续走势。通过Keras中的API，我们轻松搭建起了一个循环神经网络对数据集，进行App激活数的预测，而这个神经网络中最主要的层是LSTM层。</p><p>还有一点请你注意，要通过历史数据预测未来是非常有难度的事情，所以，我们并不能够单纯的依赖于模型给出的结果。在实际情况中，影响未来的因子有很多，就拿股票的价格为例，一个预测系统不仅仅要有历史股价，还要结合当前市场的整体行情、新闻信息、公司财报等多方面的数据来建立模型才较为完善。但即使如此，我们仍然是很难预测走势的。像我们的App激活数的预测，会比股票价格预测简单一些，那也需要更多的产品、运营等更多信息，把这些信息和历史数据同时传递给模型，才能够训练出更有意义的模型。</p><h2 id="思考题"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08#思考题"><span class="icon icon-link"></span></a>思考题</h2><p>这节课就到这里了，我给你留一个思考题：</p><p>我们说，在Keras中，一共有三种主要的循环神经网络层，分别是SimpleRNN、GRU和LSTM，我们今天使用了其中最强大的LSTM层，请你试着用其它两种解决今天的问题。</p><p>欢迎你在留言区和我分享你的观点，如果你认为这节课的内容有收获，也欢迎把它分享给你的朋友，我们下一讲再见！</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimaged540d5f7c3591c99e0fd04997ef76738e940.8eb3aa28.jpg" alt=""/></p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/零基础实战机器学习/03.业务场景闯关篇/08.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/23 21:58:31</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-other/umi.js"></script>
  </body>
</html>
