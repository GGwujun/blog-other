<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-other/umi.css" />
    <script>
      window.routerBase = "/blog-other";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>06 | 聚类分析：如何用RFM给电商用户做价值分组画像？ - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/零基础实战机器学习/03.业务场景闯关篇/02" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-other/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>前端开发<ul><li><a href="/blog-other/说透低代码">说透低代码</a></li><li><a href="/blog-other/反爬虫兵法演绎20讲">反爬虫兵法演绎20讲</a></li></ul></span><span>产品与用户体验<ul><li><a href="/blog-other/大厂广告产品心法">大厂广告产品心法</a></li></ul></span><span>面试<ul><li><a href="/blog-other/技术面试官识人手册">技术面试官识人手册</a></li><li><a href="/blog-other/面试现场">面试现场</a></li></ul></span><span>杂谈<ul><li><a href="/blog-other/乔新亮的cto成长复盘">乔新亮的cto成长复盘</a></li><li><a href="/blog-other/互联网人的英语私教课">互联网人的英语私教课</a></li><li><a href="/blog-other/从0开始学游戏开发">从0开始学游戏开发</a></li><li><a href="/blog-other/全栈工程师修炼指南">全栈工程师修炼指南</a></li><li><a href="/blog-other/手机摄影">手机摄影</a></li><li><a href="/blog-other/物联网开发实战">物联网开发实战</a></li><li><a href="/blog-other/白话法律42讲">白话法律42讲</a></li><li><a href="/blog-other/说透5g">说透5g</a></li><li><a href="/blog-other/超级访谈对话张雪峰">超级访谈对话张雪峰</a></li><li><a aria-current="page" class="active" href="/blog-other/零基础实战机器学习">零基础实战机器学习</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-other/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>前端开发<ul><li><a href="/blog-other/说透低代码">说透低代码</a></li><li><a href="/blog-other/反爬虫兵法演绎20讲">反爬虫兵法演绎20讲</a></li></ul></li><li>产品与用户体验<ul><li><a href="/blog-other/大厂广告产品心法">大厂广告产品心法</a></li></ul></li><li>面试<ul><li><a href="/blog-other/技术面试官识人手册">技术面试官识人手册</a></li><li><a href="/blog-other/面试现场">面试现场</a></li></ul></li><li>杂谈<ul><li><a href="/blog-other/乔新亮的cto成长复盘">乔新亮的cto成长复盘</a></li><li><a href="/blog-other/互联网人的英语私教课">互联网人的英语私教课</a></li><li><a href="/blog-other/从0开始学游戏开发">从0开始学游戏开发</a></li><li><a href="/blog-other/全栈工程师修炼指南">全栈工程师修炼指南</a></li><li><a href="/blog-other/手机摄影">手机摄影</a></li><li><a href="/blog-other/物联网开发实战">物联网开发实战</a></li><li><a href="/blog-other/白话法律42讲">白话法律42讲</a></li><li><a href="/blog-other/说透5g">说透5g</a></li><li><a href="/blog-other/超级访谈对话张雪峰">超级访谈对话张雪峰</a></li><li><a aria-current="page" class="active" href="/blog-other/零基础实战机器学习">零基础实战机器学习</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-other/零基础实战机器学习">零基础实战机器学习</a></li><li><a href="/blog-other/零基础实战机器学习/01.开篇词">01.开篇词</a><ul><li><a href="/blog-other/零基础实战机器学习/01.开篇词/01"><span>开篇词｜开发者为什么要从实战出发学机器学习？</span></a></li></ul></li><li><a href="/blog-other/零基础实战机器学习/02.准备篇">02.准备篇</a><ul><li><a href="/blog-other/零基础实战机器学习/02.准备篇/01"><span>01｜打好基础：到底什么是机器学习？</span></a></li><li><a href="/blog-other/零基础实战机器学习/02.准备篇/02"><span>02｜工具准备：安装并使用Jupyter Notebook</span></a></li><li><a href="/blog-other/零基础实战机器学习/02.准备篇/03"><span>03｜实战5步（上）：怎么定义问题和预处理数据？</span></a></li><li><a href="/blog-other/零基础实战机器学习/02.准备篇/04"><span>04｜ 实战5步（下）：怎么建立估计10万+软文点击率的模型？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇">03.业务场景闯关篇</a><ul><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/01"><span>05 | 数据探索：怎样从数据中找到用户的RFM值？</span></a></li><li><a aria-current="page" class="active" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/02"><span>06 | 聚类分析：如何用RFM给电商用户做价值分组画像？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/03"><span>07｜回归分析：怎样用模型预测用户的生命周期价值？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/04"><span>08 | 模型优化（上）：怎么用特征工程提高模型效率？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/05"><span>09｜模型优化（中）：防止过拟合，模型也不能太精细</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/06"><span>10｜模型优化（下）：交叉验证，同时寻找最优的参数</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/07"><span>11｜深度学习（上）：用CNN带你认识深度学习</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/08"><span>12｜深度学习（中）：如何用RNN预测激活率走势？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/09"><span>13｜深度学习（下）：3招提升神经网络预测准确率</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/10"><span>14｜留存分析：哪些因素会影响用户的留存率？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/11"><span>15｜二元分类：怎么预测用户是否流失？从逻辑回归到深度学习</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/12"><span>16｜性能评估：不平衡数据集应该使用何种评估指标？</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/13"><span>17｜集成学习：机器学习模型如何“博采众长”?</span></a></li><li><a href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/14"><span>18 | 增长模型：用XGBoost评估裂变海报的最佳受众群体</span></a></li></ul></li><li><a href="/blog-other/零基础实战机器学习/04.持续赋能篇">04.持续赋能篇</a><ul><li><a href="/blog-other/零基础实战机器学习/04.持续赋能篇/01"><span>19 | 胸有成竹：如何快速定位合适的机器学习算法？</span></a></li><li><a href="/blog-other/零基础实战机器学习/04.持续赋能篇/02"><span>20 | 模型部署：怎么发布训练好的机器学习模型？</span></a></li><li><a href="/blog-other/零基础实战机器学习/04.持续赋能篇/03"><span>21｜持续精进：如何在机器学习领域中找准前进的方向？</span></a></li></ul></li><li><a href="/blog-other/零基础实战机器学习/05.结束语">05.结束语</a><ul><li><a href="/blog-other/零基础实战机器学习/05.结束语/01"><span>一套习题，测出你对机器学习的掌握程度</span></a></li><li><a href="/blog-other/零基础实战机器学习/05.结束语/02"><span>结束语 | 可以不完美，但重要的是马上开始</span></a></li></ul></li><li><a href="/blog-other/零基础实战机器学习/summary">零基础实战机器学习</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="06--聚类分析如何用rfm给电商用户做价值分组画像"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/02#06--聚类分析如何用rfm给电商用户做价值分组画像"><span class="icon icon-link"></span></a>06 | 聚类分析：如何用RFM给电商用户做价值分组画像？</h1><p>你好，我是黄佳。欢迎来到零基础实战机器学习。</p><p>在上一讲中，我们从一份互联网电商“易速鲜花”的历史订单数据集中，求出了每一个用户的R、F、M值。你可能会问，从这些值中，我们又能看出什么有价值的信息呢？</p><p>别着急，在这一讲中，我们继续往前走，看看如何从这些枯燥且不容易观察的数据中，得到更为清晰的用户分组画像。通过这节课，我希望你能理解聚类算法的原理和最优化过程，这可以帮你建立起针对问题选择算法的直觉。</p><h1 id="怎么给用户分组比较合适"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/02#怎么给用户分组比较合适"><span class="icon icon-link"></span></a>怎么给用户分组比较合适？</h1><p>这是我们在上节课中得出的用户层级表，表中有每位用户的R、F、M值。</p><p><img src="data:image/png;base64,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" alt=""/></p><p>这里，我们希望看看R值、F值和M值的分布情况，以便为用户分组作出指导。代码是接着上一讲的基础上继续构建，我就不全部贴上来了，完整的代码和数据集请你从<a target="_blank" rel="noopener noreferrer" href="https://github.com/huangjia2019/geektime/tree/main/%E8%8E%B7%E5%AE%A2%E5%85%B306">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>下载。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">df_user[&#x27;R值&#x27;].plot(kind=&#x27;hist&#x27;, bins=20, title = &#x27;新进度分布直方图&#x27;) #R值直方图</span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">df_user.query(&#x27;F值 &lt; 800&#x27;)[&#x27;F值&#x27;].plot(kind=&#x27;hist&#x27;, bins=50, title = &#x27;消费频率分布直方图&#x27;) #F值直方图</span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">df_user.query(&#x27;M值 &lt; 20000&#x27;)[&#x27;M值&#x27;].plot(kind=&#x27;hist&#x27;, bins=50, title = &#x27;消费金额分布直方图&#x27;) #M值直方图</span></div></pre></div><p>分别输出如下结果：</p><p><img src="data:image/png;base64,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" alt=""/><img src="data:image/png;base64,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" alt=""/><img src="data:image/png;base64,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" alt=""/></p><p>可以看到，我们求出的R值、F值和M值的覆盖区间都很大。就拿R值来说，有的用户7天前购物，R值为7；有的用户70天前购物，R值为70；还有的用户187天前购物，R值为187。</p><p>那现在问题来了，如果说我们的目标是根据R值把用户分为几个不同的价值组，那么怎么分组比较合适呢？</p><p>其实，这个问题又可以拆分为两个子问题：</p><ol><li>分成多少个组比较好？</li><li>从哪个值到哪个值归为第一组（比如0-30天是一组），从哪个值到哪个值归为第二组（比如30天-70天是一组）？</li></ol><p>对于这两个问题的答案，有人肯定会说，可以凭借经验来人为确定。比如说，把用户分为高、中、低三个组，比如R值为0到50的分为一个组，50到150的分为一组，150天以上的归为一组。</p><p>这样的人为分组似乎也可以，但它存在一些弊端：首先，分组的准确性完全取决于人的经验，如果分得不准，效果就不好。其次，人为分组是静态的，如果用户情况变化了，我们还是用同样的区间来分组，就不是很合适。</p><p>那怎么办呢？我想你已经猜到了，其实该怎么分组，我们说了不算，要数据说了算。所以，要解决这个问题，还是要通过机器学习算法，根据数据的实际情况来动态地确定分组。因为只有这样的模型才是动态的，才能长期投入使用。</p><p>坚定了这一点后，我们考虑一下选什么算法来建立模型。</p><h1 id="聚类算法中的k-means算法"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/02#聚类算法中的k-means算法"><span class="icon icon-link"></span></a>聚类算法中的K-Means算法</h1><p>首先，我们要搞清楚，给用户做分组画像属于监督学习问题，还是无监督学习问题？我们要通过历史订单数据来给用户分组，这是没有任何已知标签可以做参照的，数据集中并没有一个字段指明用户的价值是“高”还是“低”，所以这显然是一个无监督学习问题。</p><p>在无监督学习中，聚类和降维是两种最常见的算法，不过它们应用场景很不一样。聚类我们说过了，主要可以用来做分组；而降维，则是通过数学变换，将原始高维属性空间转变为一个低维“子空间”，它本质上是通过最主要的几个特征维度实现对数据的描述。很显然，我们的问题适合用聚类算法来解决。</p><p>聚类算法可以让机器把数据集中的样本按照特征的性质分组，不过它只是帮我们把数据特征彼此邻近的用户聚成一组（这里的组称为聚类的簇）。而这里说的“特征彼此邻近”，指的这些用户的数据特征在坐标系中有更短的向量空间距离。也就是说，<strong>聚类算法是把空间位置相近的特征数据归为同一组。</strong></p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage048904df8ab44fd06507930b312bf3647889.37ceab98.png" alt="" title="聚类算法把空间位置相近的数据归为同一组"/></p><p>不过，请你注意，聚类算法本身并不知道哪一组用户是高价值，哪一组用户是低价值。分完组之后，我们还要根据机器聚类的结果，人为地给这些用户组贴标签，看看哪一组价值高，哪一组价值低。我这里把这种人为贴标签的过程称为“<strong>聚类后概念化</strong>”。等你学完这节课，就能更清楚我为什么要做“聚类后概念化”了。</p><p>搞清楚问题适合用聚类算法解决还不够，因为聚类的算法可不止一种，我们还要进一步确定采用哪一个算法。这里我直接选用K-Means（K-均值）算法了，因为这个算法不仅简洁，而且效率也高，是我们最常用的聚类算法。像文档归类、欺诈行为检测、用户分组等等这些场景，我们往往都能用到。</p><p>说到这里，你也许很疑惑：在监督学习中，模型都是要依赖于标签才能创建出来，这无监督学习怎么就这么聪明，能在没有标签的情况下自动给数据点分组？下面我就带你探寻其中的奥秘。</p><p>在K-Means算法中，“K”是一个关键。K代表聚类的簇（也就是组）的个数。比如说，我们想把M值作为特征，将用户分成3个簇（即高、中、低三个用户组），那这里的K值就是3，并且需要我们人工指定。</p><p>指定K的数值后，K-Means算法会在数据中随机挑选出K个数据点，作为簇的质心（centroid），这些质心就是未来每一个簇的中心点，算法会根据其它数据点和它的距离来进行聚类。</p><p>挑选出质心后，K-Means算法会遍历每一个数据点，计算它们与每一个质心的距离（比如欧式距离）。数据点离哪个质心近，就跟哪个质心属于一类。</p><p>遍历结束后，每一个质心周围就都聚集了很多数据点，这时候啊，算法会在数据簇中选择更靠近中心的质心，如果原来随机选择的质心不合适，就会让它下岗。</p><p>在整个聚类过程中，为了选择出更好的质心，“挑选质心”和“遍历数据点与质心的距离”会不断重复，直到质心的移动变化很小了，或者说固定不变了，那K-Means算法就可以停止了。</p><p>我用下面的图来帮助你理解质心在聚类过程中逐渐移动到最佳位置，以及簇的形成过程：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimagee90be9042e10d793c15de377e6d904f7280b.b621297b.jpg" alt="" title="聚类中心（质心）的移动和簇形成的过程"/></p><p>理解了聚类算法的原理，我们继续来思考一个问题：我们前面说K值需要人工指定，那怎么在算法的辅助下确定K值呢？</p><h1 id="手肘法选取k值"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/02#手肘法选取k值"><span class="icon icon-link"></span></a>手肘法选取K值</h1><p>其实，在事先并不是很确定分成多少组比较合适的情况下，“手肘法”（elbow method）可以帮我们决定，在某一批数据点中，数据分为多少组比较合适。这里我要特别说明一下，尽管我们前面说要把用户分为高、中、低三个价值组，但是R、F、M的值却可以分成很多组，并不一定都是3组。</p><p>手肘法是通过聚类算法的损失值曲线来直观确定簇的数量。损失值曲线，就是以图像的方法绘出，取每一个K值时，各个数据点距离质心的平均距离。如下图所示，当K取值很小的时候，整体损失很大，也就是说各个数据点距离质心的距离特别大。而随着K的增大，损失函数的值会在逐渐收敛之前出现一个拐点。此时的K值就是一个比较好的值。</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage9b669ba43dc8c0dc4060eb281e7dbf253d66.c9086a85.jpg" alt="" title="手肘法——确定最佳K值\n"/></p><p>你看图中，损失随着簇的个数而收敛的曲线大概像个手臂，最佳K值的点像是一个手肘，这就是为什么我们会叫它“手肘法”的原因。</p><p>下面我们就用代码找出R值的手肘点。请你注意，这里我会先定义一个找手肘点的函数，因为后面在对R值、F值和M值聚类的过程中，我们都要用到这个函数。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">from sklearn.cluster import KMeans #导入KMeans模块</span></div><div class="token-line"><span class="token plain">    def show_elbow(df): #定义手肘函数</span></div><div class="token-line"><span class="token plain">        distance_list = [] #聚质心的距离（损失）</span></div><div class="token-line"><span class="token plain">        K = range(1,9) #K值范围</span></div><div class="token-line"><span class="token plain">        for k in K:</span></div><div class="token-line"><span class="token plain">            kmeans = KMeans(n_clusters=k, max_iter=100) #创建KMeans模型</span></div><div class="token-line"><span class="token plain">            kmeans = kmeans.fit(df) #拟合模型</span></div><div class="token-line"><span class="token plain">            distance_list.append(kmeans.inertia_) #创建每个K值的损失</span></div><div class="token-line"><span class="token plain">        plt.plot(K, distance_list, &#x27;bx-&#x27;) #绘图</span></div><div class="token-line"><span class="token plain">        plt.xlabel(&#x27;k&#x27;) #X轴</span></div><div class="token-line"><span class="token plain">        plt.ylabel(&#x27;距离均方误差&#x27;) #Y轴</span></div><div class="token-line"><span class="token plain">        plt.title(&#x27;k值手肘图&#x27;) #标题</span></div></pre></div><p>在这段代码中，核心部分是拟合kmeans模型之后，通过 kmeans.inertia_计算损失值。损失会随着K值的增大而逐渐减小，而那个拐点就是手肘。</p><p>然后我们调用下面这个函数，显示R值、F值和M值聚类的K值手肘图：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">show_elbow(df_user[[&#x27;R值&#x27;]]) #显示R值聚类K值手肘图</span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">show_elbow(df_user[[&#x27;F值&#x27;]]) #显示F值聚类K值手肘图</span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">show_elbow(df_user[[&#x27;M值&#x27;]]) #显示M值聚类K值手肘图</span></div></pre></div><p>输出如下：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage01c801ae89f69241886271d539632b95d9c8.61dc0510.jpg" alt="" title="R、F和M值的K值手肘图"/></p><p>可以看到，R、F、M值的拐点大概都在2到4之间附近，这就意味着我们把用户分成2、3、4个组都行。这里我选择3作为R值的簇的个数，选择4作为F值的簇的个数，选择3作为M值的簇的个数。</p><p>那到这里为止呢，我们已经选定好了算法，并确定了R、F、M每个特征下簇的个数，也就是K值。接下来我们就可以开始创建聚类模型了。</p><h1 id="创建和训练模型"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/02#创建和训练模型"><span class="icon icon-link"></span></a>创建和训练模型</h1><p>前面说了，我们在手肘附近选择3作为R的K值，所以我们创建模型是把n_clusters参数，也就是簇的个数指定为3。这样，聚类算法会把用户的R值分为三个层次。对于F、M，我们也根据对应的K值做类似的操作：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">from sklearn.cluster import KMeans #导入KMeans模块</span></div><div class="token-line"><span class="token plain">    kmeans_R = KMeans(n_clusters=3) #设定K=3</span></div><div class="token-line"><span class="token plain">    kmeans_F = KMeans(n_clusters=4) #设定K=4</span></div><div class="token-line"><span class="token plain">    kmeans_M = KMeans(n_clusters=4) #设定K=4</span></div></pre></div><p>这样，我们就在程序中创建了一个K-Means聚类模型。<br/>创建好模型后，我们借助fit方法，用R值的数据，训练模型。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">kmeans_R.fit(df_user[[&#x27;R值&#x27;]]) #拟合模型</span></div><div class="token-line"><span class="token plain">    kmeans_F.fit(df_user[[&#x27;F值&#x27;]]) #拟合模型</span></div><div class="token-line"><span class="token plain">    kmeans_M.fit(df_user[[&#x27;M值&#x27;]]) #拟合模型</span></div></pre></div><p>我们不是第一次见到fit这个方法了，fit，翻译成中文就叫做拟合模型。基本上所有的机器学习模型都是用fit语句来进行模型训练的。</p><h1 id="使用模型进行聚类并给用户分组"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/02#使用模型进行聚类并给用户分组"><span class="icon icon-link"></span></a>使用模型进行聚类，并给用户分组</h1><p>模型训练好了，现在我们就用它给R、F、M值聚类。</p><ol><li><strong>给R、F、M值聚类</strong></li></ol><p>我们先用kmeans模型中的predict方法给R值聚类。“predict”翻译成中文是“预测”，不过作为无监督学习方法，它其实就是使用模型进行聚类，而且，也不需要进一步的评估过程。这也是监督学习和无监督学习不一样的地方。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">df_user[&#x27;R值层级&#x27;] = kmeans_R.predict(df_user[[&#x27;R值&#x27;]]) #通过聚类模型求出R值的层级</span></div><div class="token-line"><span class="token plain">    df_user.head() #显示头几行数据</span></div></pre></div><p>这段代码的输出如下：</p><p><img src="data:image/png;base64,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" alt=""/></p><p>输出显示，这个聚类结果被附加到了用户层级表中，也就是说在用户层级表中的“用户码”、“R值”字段后面出现了“R值层级”这个字段，也就是将R值聚类后各个簇的号码。</p><p>下面我们用groupby语句来看看0、1、2这几个簇的用户基本统计数据：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">df_user.groupby(&#x27;R值层级&#x27;)[&#x27;R值&#x27;].describe() #R值层级分组统计信息</span></div></pre></div><p>这段代码的输出如下：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage6a396a4375097ce237d709c9d1882697b039.dba0b74b.png" alt=""/></p><p>这里有一个奇怪的现象，不知道你有没有观察到？</p><p>如果你注意看0、1和2这三个簇，也就是三个组，就会发现形成的簇没有顺序。你看，0群的用户最多670个人，均值显示他们平均购物间隔是31天，上次购物距今是0天到94天，这是相对频繁的购物用户群。</p><p>1群的用户平均购物间隔为295天，上次购物距现在是231天到372天，这是在休眠中的用户；而2群的用户平均购货间隔则变成了157天，介于两者之间，他们上次购物距今是从95天到225天。你会发现这个从０到２的顺序既不是升序，也不是降序。</p><p>这其实是聚类这种算法本身的问题。聚类，作为一种无监督学习算法，是不知道顺序的重要性的，它只是盲目地把用户分群（按照其空间距离的临近性），而不管每个群的具体意义，因此也就没有排序的功能。这也就是我前面说的“聚类后概念化”的具体意思。聚类并不知道那组人的价值高低，所以也就无法确定顺序，需要我们人为来排序。</p><ol start="2"><li><strong>为聚类的层级做排序</strong></li></ol><p>那么，下面我们就用一段代码，把聚类的结果做一个排序，让0、1、2这三个组体现出价值的高低。这段代码稍微有点长，不过我给出了详细的注释，你可以看一下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">#定义一个order_cluster函数为聚类排序</span></div><div class="token-line"><span class="token plain">    def order_cluster(cluster_name, target_name,df,ascending=False):</span></div><div class="token-line"><span class="token plain">        new_cluster_name = &#x27;new_&#x27; + cluster_name #新的聚类名称</span></div><div class="token-line"><span class="token plain">        df_new = df.groupby(cluster_name)[target_name].mean().reset_index() #按聚类结果分组，创建df_new对象</span></div><div class="token-line"><span class="token plain">        df_new = df_new.sort_values(by=target_name,ascending=ascending).reset_index(drop=True) #排序</span></div><div class="token-line"><span class="token plain">        df_new[&#x27;index&#x27;] = df_new.index #创建索引字段</span></div><div class="token-line"><span class="token plain">        df_new = pd.merge(df,df_new[[cluster_name,&#x27;index&#x27;]], on=cluster_name) #基于聚类名称把df_new还原为df对象，并添加索引字段</span></div><div class="token-line"><span class="token plain">        df_new = df_new.drop([cluster_name],axis=1) #删除聚类名称</span></div><div class="token-line"><span class="token plain">        df_new = df_new.rename(columns={&quot;index&quot;:cluster_name}) #将索引字段重命名为聚类名称字段</span></div><div class="token-line"><span class="token plain">        return df_new #返回排序后的df_new对象</span></div></pre></div><p>在上述代码中，为聚类做排序的是order_cluster函数。那么接下来，我们再调用这个order_cluster函数，把用户表重新排序。我们知道，消费天数间隔的均值越小，用户的价值就越高，所以我们在这里采用降序，也就是把ascending参数设为False：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">df_user = order_cluster(&#x27;R值层级&#x27;, &#x27;R值&#x27;, df_user, False) #调用簇排序函数</span></div><div class="token-line"><span class="token plain">    df_user = df_user.sort_values(by=&#x27;用户码&#x27;,ascending=True).reset_index(drop=True) #根据用户码排序</span></div><div class="token-line"><span class="token plain">    df_user.head() #显示头几行数据</span></div></pre></div><p>此时，各用户的层级值就发生了变化，比如用户14688的簇编号从1变成了2，因为这个用户7天前曾经购物，其R值相对偏低，放在高分的2层级是合适的。其实，上面的代码中，我们并没有改变用户的分组，而只是改变了每一个簇的编号，这样层级关系就能体现出来了。</p><p>下面我们重新显示各个层级的信息：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">df_user.groupby(&#x27;R值层级&#x27;)[&#x27;R值&#x27;].describe() #R值层级分组统计信息</span></div></pre></div><p>输出如下：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage937c93b9d8c72da873dc6fae6643f5d6787c.3f74ec48.png" alt=""/></p><p>你会看到，此时各个簇已经形成了次序。0层级的用户，平均新近度是298天，1层级的用户，平均新近度是157天，而R值最高的用户组（2层级），平均新近度仅有32天。这说明用户上一次消费距今的天数越少，其R值的价值越高。</p><p>R值聚类做好后，我们按照同样的方法可以根据用户购买频率给F值做聚类，并用刚才定义的order_cluster函数为聚类之后的簇进行排序，确定层级。因为消费次数越多，价值越高，所以我们把order_cluster 函数的ascending参数设定为True，也就是升序：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">df_user[&#x27;F值层级&#x27;] = kmeans_F.predict(df_user[[&#x27;F值&#x27;]]) #通过聚类模型求出F值的层级</span></div><div class="token-line"><span class="token plain">    df_user = order_cluster(&#x27;F值层级&#x27;, &#x27;F值&#x27;,df_user,True) #调用簇排序函数</span></div><div class="token-line"><span class="token plain">    df_user.groupby(&#x27;F值层级&#x27;)[&#x27;F值&#x27;].describe() #F值层级分组统计信息</span></div></pre></div><p>输出如下：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimageb1a9b17366087ca2f0f32eba40cd5d78c9a9.99ce021c.png" alt=""/></p><p>上图显示，经过了排序的层级中，0级用户的购买频率均值为32次，1级的用户消费频率均值为153次，2级用户消费频率均值达到416次，而2级用户的消费频率均值高达1295次，不过这个簇中只有7个用户。</p><p>还是一样，我们重新为用户层级表排序，并显示df_user对象，也就是用户层级表的当前状态。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">df_user = df_user.sort_values(by=&#x27;用户码&#x27;,ascending=True).reset_index(drop=True) #根据用户码排序</span></div><div class="token-line"><span class="token plain">    df_user.head()</span></div></pre></div><p>输出如下：</p><p><img src="data:image/png;base64,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" alt=""/></p><p>最后，我们依葫芦画瓢，给M值做聚类，并且对聚类的结果做排序，分出层级。因为代码和R值、F值聚类十分相似，我就直接给出所有代码，不再说明了。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">df_user[&#x27;M值层级&#x27;] = kmeans_M.predict(df_user[[&#x27;M值&#x27;]]) #通过聚类模型求出M值的层级</span></div><div class="token-line"><span class="token plain">    df_user = order_cluster(&#x27;M值层级&#x27;, &#x27;M值&#x27;,df_user,True) #调用簇排序函数</span></div><div class="token-line"><span class="token plain">    df_user.groupby(&#x27;M值层级&#x27;)[&#x27;M值&#x27;].describe() #M值层级分组统计信息</span></div><div class="token-line"><span class="token plain">    df_user = df_user.sort_values(by=&#x27;用户码&#x27;,ascending=True).reset_index(drop=True) #根据用户码排序</span></div><div class="token-line"><span class="token plain">    df_user.head() #显示头几行数据</span></div></pre></div><p>最终结果：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAX8AAACfCAMAAAAmqSljAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAALxUExURf/////HhAAAUqXj/6Xi///HhQEBUqTi/v//56VVAAAAAP//xoQAAABVpef//8aCAAAAhISCAACCxlKm54TH/1Km5qVVAYQBAITH/saCAf7//4QBAQEAAFKl5oUBAf7/56VWAYTG/gEBAACBxf3+/8b//+emUoTH5//jpVIAAOb//wEAUgEBAeemU4PG/gFVpOb+/+enU4PG5qZWAQGCxf7+/+f/xlKmxsb+/+amUgBVpOb+xgAAg8X+/saDAf7/xgGBxeamU1Omxeb+/qXjxgBVhIRVAMb/5wEAhKXixsb+51JVUsX+/1MBAQEBhP7jpf7+xqTixQFVg4NVAQEAg8X+5samUoTHxlKBg1IBAaSlhP7HhcWmUoPGxYPG/VKlxcXGhOfjxoSChP7HhMWCAQEBg4SBg8X9/qXHpVIAUlKmpaTGpVIBUqXixVKlpMbHhFIBAP/jpsbjpcbipcXipaVVUgCChNGmUtCmUgGCxoTH5gGCg4MBAf7+5/39/fX19fX1vn8AAAAAT5/a9b59AE+f3gB9vvW/f/Xan08Af7719QAAf3+/9U8AAL59AZ/Z9QF9vfT19QBSnt309QB9vd6fUFABAQAAfr309L5+AZ7Z9ABSn9719fX13p9SAE8AT96fT38AfwFSn9319QEAf7709X++9FABT5/Z9J9TAU+f3QEBT/W/gN6gUN309AEBf73z9H99AE9Sn5+/n38BAH+/9H8Bf1ABf7309QF9vvT09VCf3YABAX++8wB9n59SAX8BAX6+9KBTAVBSn9709b303p9ST59TT5/a9E99f399f38ATwFSnvT1voABT0+e3VIAhACCxYQAhAFVpVOm5lJVpVMBhITG/caCUgCCpcX+51Ol5lMBUqXi/sX+xuf/5wB9f719Ad303p/avk8BT1Cfn77an38BT08BAIQAUoQBUqVWU6Xj/sb/xqWmUoQBhKWlUub+5/XaoJ6+n08Bf0+fn5+eT771vr30vr709N713nxOuMAAAAABYktHRACIBR1IAAAAB3RJTUUH5wkXBzoBUKp0pwAAAAFvck5UAc+id5oAABDLSURBVHja7Z17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" alt=""/></p><p>好，那到这里为止，R、F、M的聚类工作就全部完成了，并且我们还划分了层级！在当前的用户层级表中，已经包含了这三个维度的层级，最终的用户分层就可以以此为基础来确定了。</p><h1 id="为用户整体分组画像"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/02#为用户整体分组画像"><span class="icon icon-link"></span></a>为用户整体分组画像</h1><p>我们这里采用简单叠加的方法把R、F、M三个层级的值相加，用相加后得到的值，作为总体价值，来给用户进行最终的分层。当然了，如果你对其中某一个指标看得比较重，也可以加权之后再相加。</p><p>具体来讲，我们用下面的代码来创建相加之后的层级，即总分字段。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">df_user[&#x27;总分&#x27;] = df_user[&#x27;R值层级&#x27;] + df_user[&#x27;F值层级&#x27;] + df_user[&#x27;M值层级&#x27;] #求出每个用户RFM总分</span></div></pre></div><p>因为R值有3个层级（0，1，2），F值有4个层级（0，1，2，3），M值有4个层级（0，1，2，3），我们把三个维度的值相加，那每一个用户的得分有可能是0到8当中的某一个值，也就是说出现了9个层次。</p><p>我这里就按照下面的规则，来确定用户最终的价值分层。当然了，你也可以尝试用其它的阈值来确定你的价值分层。</p><ul><li>0-2分，低价值用户</li><li>3-4分，中价值用户</li><li>5-8分，高价值用户</li></ul><p>什么意思呢？举例来说，就是如果一个用户在R值拿到了2分，在新近度这个维度为高价值用户，但是在消费频率和消费金额这两个维度都只拿到0分，那么最后得分就为2，总体只能评为低价值用户。</p><p>下面这段代码便是根据总分，来确定出每一个用户的总体价值的。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">#在df_user对象中添加总体价值这个字段</span></div><div class="token-line"><span class="token plain">    df_user.loc[(df_user[&#x27;总分&#x27;]&lt;=2) &amp; (df_user[&#x27;总分&#x27;]&gt;=0), &#x27;总体价值&#x27;] = &#x27;低价值&#x27; </span></div><div class="token-line"><span class="token plain">    df_user.loc[(df_user[&#x27;总分&#x27;]&lt;=4) &amp; (df_user[&#x27;总分&#x27;]&gt;=3), &#x27;总体价值&#x27;] = &#x27;中价值&#x27; </span></div><div class="token-line"><span class="token plain">    df_user.loc[(df_user[&#x27;总分&#x27;]&lt;=8) &amp; (df_user[&#x27;总分&#x27;]&gt;=5), &#x27;总体价值&#x27;] = &#x27;高价值&#x27;</span></div><div class="token-line"><span class="token plain">    df_user #显示df_user</span></div></pre></div><p>我们再次输出df_user对象，看一看最终的用户层级表：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage8baa8b98da066d42e514b4d54f4c4ec62daa.49981939.png" alt=""/></p><p>此时，980个用户的R、F、M层级，还有总体价值的层级都非常清楚了。对于每一个用户，我们都可以迅速定位到他的价值。那到这里，我们就成功地完成了为“易速鲜花”公司做用户价值分组的工作。</p><p>现在，有了用户的价值分组标签，我们就可以做很多进一步的分析，比如说选取R、F、M中任意两个维度，并把高、中、低价值用户的散点图进行呈现：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">#显示高、中、低价值组分布散点图（F值与M值）</span></div><div class="token-line"><span class="token plain">    plt.scatter(df_user.query(&quot;总体价值 == &#x27;高价值&#x27;&quot;)[&#x27;F值&#x27;],</span></div><div class="token-line"><span class="token plain">                       df_user.query(&quot;总体价值 == &#x27;高价值&#x27;&quot;)[&#x27;M值&#x27;],c=&#x27;g&#x27;,marker=&#x27;*&#x27;)</span></div><div class="token-line"><span class="token plain">    plt.scatter(df_user.query(&quot;总体价值 == &#x27;中价值&#x27;&quot;)[&#x27;F值&#x27;],</span></div><div class="token-line"><span class="token plain">                       df_user.query(&quot;总体价值 == &#x27;中价值&#x27;&quot;)[&#x27;M值&#x27;],marker=8)</span></div><div class="token-line"><span class="token plain">    plt.scatter(df_user.query(&quot;总体价值 == &#x27;低价值&#x27;&quot;)[&#x27;F值&#x27;],</span></div><div class="token-line"><span class="token plain">                       df_user.query(&quot;总体价值 == &#x27;低价值&#x27;&quot;)[&#x27;M值&#x27;],c=&#x27;r&#x27;)</span></div><div class="token-line"><span class="token plain">    各价值组的用户分布散点图如下图所示：</span></div></pre></div><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage28d5286a4d8050b94f746ac61533372d11d5.f3681faa.png" alt=""/></p><p>借此，我们可以发现，高价值用户（绿色五星）覆盖在消费频率较高的区域，和F值相关度高。而在总消费金额大于5000元的用户中，中高价值的用户（绿色五星和红色圆点）都有。</p><p>当然，作为运营部门的一员，你还可以通过对新老用户的价值分组，制定出更有针对性的获客、营销、推广等运营方案。</p><h1 id="总结一下"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/02#总结一下"><span class="icon icon-link"></span></a>总结一下</h1><p>好啦，到这里，我们就成功闯过了“获客”这个关卡。现在来回顾一下这一讲中的重点内容。</p><p>在这一讲中， 我们理解了聚类算法的原理，学会了如何用手肘法选择K值，以及如何用K-均值算法来给R值、F值和M值做聚类。</p><p>我要再次强调的是，聚类只是负责把空间距离相近的数据点分成不同的簇，它并不知道每一个簇代表的具体含义。比如说，我们用K-Means算法给R值分成三个簇，这并不表示0比1价值低，1比2价值低。此时的0、1、2都是聚类随机分配的编号，具体分组排序的工作我们还要单独去完成。</p><p>在K值的选择方面呢，手肘法可以帮我们直观地显示出聚类过程中整体损失的“拐点”，我们可以在拐点或者拐点附近选择K值，确定把数据分成多少个“簇”（也就是多少个组）。</p><p>最后，我们还讲到用K-均值算法来给R值做聚类，这也非常简单，就是创建模型、拟合模型、用模型进行聚类，这些过程加一块也就是几行代码的事儿，你不用有负担。</p><p>掌握了上述这些内容，你就可以用K-Means算法这种无监督学习算法给任何数据集做聚类，来解决其它类似的问题了，比如根据学生的考试成绩，为学生分组聚类等等。</p><h1 id="思考题"><a aria-hidden="true" tabindex="-1" href="/blog-other/零基础实战机器学习/03.业务场景闯关篇/02#思考题"><span class="icon icon-link"></span></a>思考题</h1><p>这节课就到这里了，我给你留两个思考题：</p><ol><li>对于K-Means算法，X特征数据集的输入，可以不止一个维度。为了给R、F、M分别分层，在这节课中我给这三者单独做了聚类。你能不能试着把R、F、M三个特征同时输入K-Means算法，为用户整体做聚类呢？此外，你还能不能想到些其它的为用户分组画像的方法呢？</li><li>聚类算法的应用场景其实很广，包括给图像的颜色簇量化分组、给文本分组等等，在你的工作和生活中，你还能够想到，或者曾用过哪些可以通过聚类解决的问题？请你分享一下。</li></ol><p>欢迎你在留言区和我分享你的观点，如果你认为这节课的内容有收获，也欢迎把它分享给你的朋友，我们下一讲再见！</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage81c1814f8483b103c69295e54c9d87c7d6c1.0a54fd98.jpg" alt=""/></p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/零基础实战机器学习/03.业务场景闯关篇/02.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/23 21:58:31</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-other/umi.js"></script>
  </body>
</html>
