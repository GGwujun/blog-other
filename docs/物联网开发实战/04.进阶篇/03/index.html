<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-other/umi.css" />
    <script>
      window.routerBase = "/blog-other";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>08 | MQTT：在实践中掌握一个通信协议 - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/物联网开发实战/04.进阶篇/03" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-other/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>前端开发<ul><li><a href="/blog-other/说透低代码">说透低代码</a></li><li><a href="/blog-other/反爬虫兵法演绎20讲">反爬虫兵法演绎20讲</a></li></ul></span><span>产品与用户体验<ul><li><a href="/blog-other/大厂广告产品心法">大厂广告产品心法</a></li></ul></span><span>面试<ul><li><a href="/blog-other/技术面试官识人手册">技术面试官识人手册</a></li><li><a href="/blog-other/面试现场">面试现场</a></li></ul></span><span>杂谈<ul><li><a href="/blog-other/乔新亮的cto成长复盘">乔新亮的cto成长复盘</a></li><li><a href="/blog-other/互联网人的英语私教课">互联网人的英语私教课</a></li><li><a href="/blog-other/从0开始学游戏开发">从0开始学游戏开发</a></li><li><a href="/blog-other/全栈工程师修炼指南">全栈工程师修炼指南</a></li><li><a href="/blog-other/手机摄影">手机摄影</a></li><li><a aria-current="page" class="active" href="/blog-other/物联网开发实战">物联网开发实战</a></li><li><a href="/blog-other/白话法律42讲">白话法律42讲</a></li><li><a href="/blog-other/说透5g">说透5g</a></li><li><a href="/blog-other/超级访谈对话张雪峰">超级访谈对话张雪峰</a></li><li><a href="/blog-other/零基础实战机器学习">零基础实战机器学习</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-other/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>前端开发<ul><li><a href="/blog-other/说透低代码">说透低代码</a></li><li><a href="/blog-other/反爬虫兵法演绎20讲">反爬虫兵法演绎20讲</a></li></ul></li><li>产品与用户体验<ul><li><a href="/blog-other/大厂广告产品心法">大厂广告产品心法</a></li></ul></li><li>面试<ul><li><a href="/blog-other/技术面试官识人手册">技术面试官识人手册</a></li><li><a href="/blog-other/面试现场">面试现场</a></li></ul></li><li>杂谈<ul><li><a href="/blog-other/乔新亮的cto成长复盘">乔新亮的cto成长复盘</a></li><li><a href="/blog-other/互联网人的英语私教课">互联网人的英语私教课</a></li><li><a href="/blog-other/从0开始学游戏开发">从0开始学游戏开发</a></li><li><a href="/blog-other/全栈工程师修炼指南">全栈工程师修炼指南</a></li><li><a href="/blog-other/手机摄影">手机摄影</a></li><li><a aria-current="page" class="active" href="/blog-other/物联网开发实战">物联网开发实战</a></li><li><a href="/blog-other/白话法律42讲">白话法律42讲</a></li><li><a href="/blog-other/说透5g">说透5g</a></li><li><a href="/blog-other/超级访谈对话张雪峰">超级访谈对话张雪峰</a></li><li><a href="/blog-other/零基础实战机器学习">零基础实战机器学习</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-other/物联网开发实战">物联网开发实战</a></li><li><a href="/blog-other/物联网开发实战/01.2022特别加更">01.2022特别加更</a><ul><li><a href="/blog-other/物联网开发实战/01.2022特别加更/01"><span>引子｜RISC-V：物联网领域值得关注的芯片趋势是什么？</span></a></li><li><a href="/blog-other/物联网开发实战/01.2022特别加更/02"><span>实战一｜嵌入式开发：如何使用C语言开发智能电灯？</span></a></li><li><a href="/blog-other/物联网开发实战/01.2022特别加更/03"><span>实战二｜MQTT开发：如何实现联网控制？</span></a></li><li><a href="/blog-other/物联网开发实战/01.2022特别加更/04"><span>假期快乐｜这是一份暂时停更的声明</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/02.开篇词">02.开篇词</a><ul><li><a href="/blog-other/物联网开发实战/02.开篇词/01"><span>开篇词 | 物联网这个趋势，你不应该错过</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/03.基础篇">03.基础篇</a><ul><li><a href="/blog-other/物联网开发实战/03.基础篇/01"><span>01 | 入门介绍：如何定义物联网？</span></a></li><li><a href="/blog-other/物联网开发实战/03.基础篇/02"><span>02 | 通信技术：设备接入网络的方式有哪些？</span></a></li><li><a href="/blog-other/物联网开发实战/03.基础篇/03"><span>03 | 网络协议：设备使用什么语言与互联网对话？</span></a></li><li><a href="/blog-other/物联网开发实战/03.基础篇/04"><span>04 | 数据分析：数据的价值有哪些？</span></a></li><li><a href="/blog-other/物联网开发实战/03.基础篇/05"><span>05 | 系统实例：怎样设计一个简易物联网系统？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-other/物联网开发实战/04.进阶篇">04.进阶篇</a><ul><li><a href="/blog-other/物联网开发实战/04.进阶篇/01"><span>06 | 物模型：如何定义智能电灯？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/02"><span>07 | 零配置组网：设备如何发现彼此？</span></a></li><li><a aria-current="page" class="active" href="/blog-other/物联网开发实战/04.进阶篇/03"><span>08 | MQTT：在实践中掌握一个通信协议</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/04"><span>09 | 边缘中心：物联网网关有多重要？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/05"><span>10 | 数据处理框架：批处理还是流处理？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/06"><span>11 | 数据存储：物联网中的数据库有哪些？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/07"><span>12 | IoT Hub：面对海量设备如何打造高性能设备接入层？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/08"><span>13 | 隐私：在实践中如何保护用户隐私？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/09"><span>14 | 安全：物联网平台如何应对安全风险？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/10"><span>15 | 平台：智能家居开源平台的生态是怎样的？</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/05.实战篇">05.实战篇</a><ul><li><a href="/blog-other/物联网开发实战/05.实战篇/01"><span>16 | 实战准备：如何搭建硬件开发环境？</span></a></li><li><a href="/blog-other/物联网开发实战/05.实战篇/02"><span>17 | 远程控制：怎样打造联网的智能电灯？</span></a></li><li><a href="/blog-other/物联网开发实战/05.实战篇/03"><span>18 | 场景联动：智能电灯如何感知光线？（上）</span></a></li><li><a href="/blog-other/物联网开发实战/05.实战篇/04"><span>19 | 场景联动：智能电灯如何感知光线？（下）</span></a></li><li><a href="/blog-other/物联网开发实战/05.实战篇/05"><span>20 | 智能语音：好玩的语音控制是怎么实现的？</span></a></li><li><a href="/blog-other/物联网开发实战/05.实战篇/06"><span>21 | 多传感器集成：浇花怎么实现自动化？</span></a></li><li><a href="/blog-other/物联网开发实战/05.实战篇/07"><span>22 | 掌控数据：家里的数据可以怎么利用？</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/06.结束语">06.结束语</a><ul><li><a href="/blog-other/物联网开发实战/06.结束语/01"><span>结束语 | 永远做一个具有极客精神的人</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/07.测试题">07.测试题</a><ul><li><a href="/blog-other/物联网开发实战/07.测试题/01"><span>结课测试 | 这些物联网的问题，你都掌握了吗？</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/08.加餐">08.加餐</a><ul><li><a href="/blog-other/物联网开发实战/08.加餐/01"><span>加餐一 | 这5本关于物联网的好书，值得一读</span></a></li><li><a href="/blog-other/物联网开发实战/08.加餐/02"><span>加餐二 | 行业应用：物联网的发展将如何重塑我们的生活？</span></a></li><li><a href="/blog-other/物联网开发实战/08.加餐/03"><span>加餐三 | 行业应用：物联网的发展将如何升级第一、第二产业？</span></a></li><li><a href="/blog-other/物联网开发实战/08.加餐/04"><span>加餐四 | 5G技术将如何推动物联网的发展？</span></a></li><li><a href="/blog-other/物联网开发实战/08.加餐/05"><span>加餐五 | 投身物联网行业，如何做好职业规划？</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/09.用户故事">09.用户故事</a><ul><li><a href="/blog-other/物联网开发实战/09.用户故事/01"><span>用户故事 | 让野蛮生长成为职业发展的助推剂</span></a></li><li><a href="/blog-other/物联网开发实战/09.用户故事/02"><span>用户故事 | 转战物联网，我相信天道酬勤</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/summary">物联网开发实战</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="体验MQTT" data-depth="2"><a href="/blog-other/物联网开发实战/04.进阶篇/03#体验mqtt"><span>体验MQTT</span></a></li><li title="MQTT 的生态很完善" data-depth="2"><a href="/blog-other/物联网开发实战/04.进阶篇/03#mqtt-的生态很完善"><span>MQTT 的生态很完善</span></a></li><li title="MQTT自身的“基因”很强大" data-depth="2"><a href="/blog-other/物联网开发实战/04.进阶篇/03#mqtt自身的基因很强大"><span>MQTT自身的“基因”很强大</span></a></li><li title="发布-订阅模式" data-depth="3"><a href="/blog-other/物联网开发实战/04.进阶篇/03#发布-订阅模式"><span>发布-订阅模式</span></a></li><li title="轻量级协议：减少传输数据量" data-depth="3"><a href="/blog-other/物联网开发实战/04.进阶篇/03#轻量级协议减少传输数据量"><span>轻量级协议：减少传输数据量</span></a></li><li title="低功耗优化：节约电量和网络资源" data-depth="3"><a href="/blog-other/物联网开发实战/04.进阶篇/03#低功耗优化节约电量和网络资源"><span>低功耗优化：节约电量和网络资源</span></a></li><li title="3种QoS级别：可靠通信" data-depth="3"><a href="/blog-other/物联网开发实战/04.进阶篇/03#3种qos级别可靠通信"><span>3种QoS级别：可靠通信</span></a></li><li title="安全传输" data-depth="3"><a href="/blog-other/物联网开发实战/04.进阶篇/03#安全传输"><span>安全传输</span></a></li><li title="小结" data-depth="2"><a href="/blog-other/物联网开发实战/04.进阶篇/03#小结"><span>小结</span></a></li><li title="思考题" data-depth="2"><a href="/blog-other/物联网开发实战/04.进阶篇/03#思考题"><span>思考题</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="08--mqtt在实践中掌握一个通信协议"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/04.进阶篇/03#08--mqtt在实践中掌握一个通信协议"><span class="icon icon-link"></span></a>08 | MQTT：在实践中掌握一个通信协议</h1><p>你好，我是郭朝斌。</p><p>在基础篇的<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/307518">第 3 讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中，我介绍了几种物联网系统中常用的网络协议。它们是物联网设备之间沟通的“语言”，使用同一种语言，双方才能通信成功。</p><p>那么，在这么多网络协议当中，最流行的是哪一种呢？毫无疑问，是MQTT协议，它甚至已经成为物联网系统事实上的网络协议标准。如果你想从事物联网开发，就一定要掌握MQTT。</p><p>所以这一讲，我就会带你了解MQTT，在实践中熟悉它的特性。</p><h2 id="体验mqtt"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/04.进阶篇/03#体验mqtt"><span class="icon icon-link"></span></a>体验MQTT</h2><p>为了让你对MQTT有一个直观的印象，我先带你体验一下它的通信过程，</p><p>第一步是安装 hbmqtt，它是一个开源的基于Python语言的 MQTT Broker 软件，正好包括我们需要使用一些工具。跟其他选择相比，这个软件安装起来非常方便，因为它在 Python 的 PYPI 软件仓库中就有，所以你通过 pip 命令就可以安装。这也是选择使用它的主要原因。</p><p>不过要注意的是，hbmqtt 是基于Python3实现的，因此这里使用的是 pip3 工具。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">pip3 install hbmqtt</span></div></pre></div><p>安装完成后，我们就可以使用 hbmqtt 中提供的 hbmqtt_sub 和 hbmqtt_pub 这两个命令行工具了。通过名字，你应该也可以看出 hbmqtt_sub 可以充当<strong>订阅者</strong>的角色；hbmqtt_pub 可以作为消息的<strong>发布者</strong>。</p><p>至于订阅者和发布者之间的经纪人，也就是 MQTT Broker，我们使用 Eclipse 免费开放的在线 <a target="_blank" rel="noopener noreferrer" href="https://mosquitto.org/">Broker 服务<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。打开链接，你可以看到关于端口的介绍信息，加密和非加密方式都支持，而且还有基于 Websocket 的实现，这对基于前端网页的应用来说是非常有利的。</p><p>我们先使用 1883端口的非加密方式，然后为消息传输确定一个主题（Topic）。主题确定了消息的类别，用于消息过滤。比如我们待会儿要测试的消息，属于极客时间平台的物联网课程，所以主题可以设为“/geektime/iot”。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">/geektime/iot</span></div></pre></div><p>接着，我们在电脑的终端界面输入下面的命令，就可以订阅这个主题消息：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">hbmqtt_sub --url mqtt://mqtt.eclipse.org:1883 -t /geektime/iot</span></div></pre></div><p>如果你想了解一些命令的执行细节，可以在上面的命令中加上 “-d” 参数。</p><p>现在，我们启动另外一个终端界面，通过 hbmqtt_pub 发布一个 “/geektime/iot” 主题的消息：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">hbmqtt_pub --url mqtt://mqtt.eclipse.org:1883 -t /geektime/iot -m Hello,World!</span></div></pre></div><p>通过 Eclipse 的开放 Broker 作为“经纪人”，消息被传输到了我们通过 hbmqtt_sub 运行的订阅者那里。下图是我的终端界面上运行的结果，一个完整的消息传输过程就这样完成了。</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage9aef9a4fe3966ac303d5defde1bd8b7yy4ef.d3a381c1.png" alt=""/></p><h2 id="mqtt-的生态很完善"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/04.进阶篇/03#mqtt-的生态很完善"><span class="icon icon-link"></span></a>MQTT 的生态很完善</h2><p>初步体验之后，不知道你是不是有这样的感觉：原来使用MQTT也没有那么难啊？</p><p>确实不难，甚至可以说很简单，这主要得益于MQTT 协议出现的时间很久远。当然，时间久远本身不是优势，能力强才是。这些长期的使用和积淀使得 MQTT 的生态非常完善，而生态是技术标准能够主导行业的关键。所以你在使用MQTT的时候会觉得很方便，可供挑选的方案有很多。</p><p>比如在上面的体验中，你要安装 MQTT，可以直接找到 <a target="_blank" rel="noopener noreferrer" href="https://github.com/beerfactory/hbmqtt">hbmqtt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 这样的项目拿来用。它的背后有 Eclipse 基金会的支持。</p><p>类似的 MQTT Broker 软件，你还可以选择基于C语言的<a target="_blank" rel="noopener noreferrer" href="http://mosquitto.org/">Mosquitto<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，基于Erlang语言的<a target="_blank" rel="noopener noreferrer" href="https://vernemq.com/">VerneMQ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>等。</p><p>至于 MQTT 的客户端（Client）实现，也有成熟的 Python、C、Java 和 JavaScript 等各种编程语言的开源实现，供你参考、使用，比如<a target="_blank" rel="noopener noreferrer" href="http://www.eclipse.org/paho/">Eclipse Paho项目<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><p>而且，还有很多商业公司在持续运营功能更丰富、支持更完备的商业版 Broker 实现，比如提供高并发能力的集群特性、方便拓展的插件机制等。这些会大大提高我们技术开发者的工作效率。比如中国一个团队开发、维护的 <a target="_blank" rel="noopener noreferrer" href="https://www.emqx.io/">EMQ X<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，它已经完整地支持 MQTT5.0协议。</p><p>另外，生态完善还有一个好处，那就是作为开发者，当你遇到难题时，可以很方便地找到很多相关的资料；就算资料解决不了问题，你还可以去社区中提问，寻求高手的帮助。这在实际工作中非常有用。顺便提一下，除了老牌的Stack Overflow，你还可以关注一下 GitHub 的 Issues 模块，因为在那里可以找到很多专家。</p><h2 id="mqtt自身的基因很强大"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/04.进阶篇/03#mqtt自身的基因很强大"><span class="icon icon-link"></span></a>MQTT自身的“基因”很强大</h2><p>当然，阿里云、华为云、腾讯云和微软 Azure 这些大厂，之所以不约而同地选择 MQTT 协议作为物联网设备的“第一语言”，不仅是因为MQTT的生态完善，MQTT协议本身的优秀设计也是重要的因素。</p><p>它在设计上的优点体现在哪呢？我想主要有五个方面：</p><ol><li>契合物联网大部分应用场景的<strong>发布-订阅模式</strong>。</li><li>能够满足物联网中资源受限设备需要的<strong>轻量级特性</strong>。</li><li>时刻关注物联网设备<strong>低功耗需求的优化设计</strong>。</li><li>针对物联网中多变的网络环境提供的<strong>多种服务质量等级</strong>。</li><li>支持在物联网应用中越来越被重视的<strong>数据安全</strong>。</li></ol><p>接下来，我分别为你剖析一下。</p><h3 id="发布-订阅模式"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/04.进阶篇/03#发布-订阅模式"><span class="icon icon-link"></span></a>发布-订阅模式</h3><p>刚才我们体验的通信过程，是一个发布者和一个订阅者的情况。在这之后，你可以再打开一个终端界面，重复和之前一样的命令，再启动一个订阅者。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">hbmqtt_sub --url mqtt://mqtt.eclipse.org:1883 -t /geektime/iot</span></div></pre></div><p>现在，这两个订阅者都订阅了“/geektime/iot” 主题的消息。</p><p>然后，你再次使用 hbmqtt_pub 发送消息，就可以看到两个订阅者都收到了同样的消息，这是<strong>发布-订阅模式</strong>的典型特征。</p><p>因为采用了发布-订阅模式，MQTT协议具有很多优点，比如能让一个传感器数据触发一系列动作；网络不稳定造成的临时离线不会影响工作；方便根据需求动态调整系统规模等。这使得它能满足绝大部分物联网场景的需求。</p><h3 id="轻量级协议减少传输数据量"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/04.进阶篇/03#轻量级协议减少传输数据量"><span class="icon icon-link"></span></a>轻量级协议：减少传输数据量</h3><p>MQTT 是一个<strong>轻量级</strong>的网络协议，这一点也是它在物联网系统中流行的重要原因。毕竟物联网中大量的都是计算资源有限、网络带宽低的设备。</p><p>这种“轻量级”体现在两个方面。一方面，MQTT 消息采用<strong>二进制的编码格式</strong>，而不是 HTTP 协议那样的文本的表述方式。</p><p>这有什么好处呢？那就是可以充分利用字节位，协议头可以很紧凑，从而尽量<strong>减少需要通过网络传输的数据量</strong>。</p><p>比如，我们分析 HTTP 的一个请求抓包，它的消息内容是下面这样的（注意：空格和回车、换行符都是消息的组成部分）：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">GET /account HTTP/1.1    &lt;--注释：HTTP请求行</span></div><div class="token-line"><span class="token plain">    Host: time.geekbang.com  &lt;--注释：以下为HTTP请求头部</span></div><div class="token-line"><span class="token plain">    Upgrade-Insecure-Requests: 1</span></div><div class="token-line"><span class="token plain">    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0</span></div><div class="token-line"><span class="token plain">    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span></div><div class="token-line"><span class="token plain">    Accept-Encoding: gzip, deflate, sdch</span></div><div class="token-line"><span class="token plain">    Accept-Language: zh-CN,zh;q=0.8,en;q=0.6</span></div><div class="token-line"><span class="token plain">                             &lt;--注释：这个空行是必须的，即使下面的请求体是空的</span></div></pre></div><p>在HTTP协议传输的这段文本中，每个字符都要占用 1 个字节。而如果使用MQTT协议，一个字节就可以表示很多内容。下面的图片展示了 MQTT 的固定头的格式，这个固定头只有2个字节：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimagee003e03f1b94406b4cf33d55c9361925e203.5cea30ab.jpg" alt=""/></p><p>你可以看到，第一个字节分成了高 4 位（4～7）和低 4 位（0～3）；低 4 位是数据包标识位，其中的每一比特位又可以表示不同的含义；高4位是不同数据包类型的标识位。</p><p>第二个字节表示数据包头部和消息体的字节共个数，其中最高位表示有没有第三字节存在，来和第二个字节一起表示字节共个数。</p><p>如果有第三个字节，那它的最高位表示是否有第四个字节，来和第二个字节、第三个字节一起表示字节总个数。依此类推，还可能有第四个字节、第五个字节，不过这个表示可变头部和消息体的字节个数的部分，最多也只能到第五个字节，所以可以表示的最大数据包长度有256MB。</p><p>比如，一个请求建立连接的 CONNECT 类型数据包，头部需要14个字节；发布消息的 PUBLISH 类型数据包头部只有2～4个字节。</p><p>轻量级的另一方面，体现在消息的具体<strong>交互流程设计非常简单</strong>，所以MQTT的交互消息类型也非常少。为了方便后面的讲解，我在这里整理了一个表格，总结了 MQTT 不同的数据包类型的功能和发消息的流向。</p><p>从表格可以看出，MQTT 3.1.1 版本一共定义了14种数据包的类型，在第一个字节的高 4 位中分别对应从 1 到 14 的数值。</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage5de45d22e10c5b00a10177d76055db93f3e4.4179dff9.jpg" alt=""/></p><h3 id="低功耗优化节约电量和网络资源"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/04.进阶篇/03#低功耗优化节约电量和网络资源"><span class="icon icon-link"></span></a>低功耗优化：节约电量和网络资源</h3><p>除了让协议足够轻量，MQTT协议还很注重<strong>低功耗</strong>的优化设计，这主要体现在对能耗和通信次数的优化。</p><p>比如，MQTT 协议有一个 <strong>Keepalive 机制</strong>。它的作用是，在 Client 和 Broker 的连接中断时，让双方能及时发现，并重新建立 MQTT 连接，保证主题消息的可靠传输。</p><p>这个机制工作的原理是：Client 和 Broker 都基于 Keepalive 确定的时间长度，来判断一段时间内是否有消息在双方之间传输。这个 Keepalive 时间长度是在Client建立连接时设置的，如果超出这个时间长度，双方没有收到新的数据包，那么就判定连接断开。</p><p>虽然Keepalive要求一段时间内必须有数据包传输，但实际情况是，Client 和 Broker 不可能时时刻刻都在传输主题消息，这要怎么办呢？</p><p>MQTT 协议的解决方案是，定义了 PINGREQ 和 PINGRESP 这两种消息类型。它们都没有可变头部和消息体，也就是说都只有 2 个字节大小。Client 和 Broker 通过分别发送 PINGREQ 和 PINGRESP 消息，就能够满足 Keepalive 机制的要求。</p><p>我猜你也想到了，如果要一直这样“傻傻地”定期发送消息，那也太浪费电量和网络资源了。所以，如果在 Keepalive 时间长度内，Client 和 Broker 之间有数据传输，那么 Keepalive 机制也会将其计算在内，这样就不需要再通过发送 PINGREQ 和 PINGRESP 消息来判断了。</p><p>除了 Keepalive 机制，MQTT 5.0 中的<strong>重复主题特性</strong>也能帮助我们节省网络资源。</p><p>Client 在重复发送一个主题的消息时，可以从第二次开始，将主题名长度设置为 0，这样 Broker 会自动按照上次的主题来处理消息。这种情况对传感器设备来说十分常见，所以这个特性在工作中很有实际意义。</p><h3 id="3种qos级别可靠通信"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/04.进阶篇/03#3种qos级别可靠通信"><span class="icon icon-link"></span></a>3种QoS级别：可靠通信</h3><p>除了计算资源有限、网络带宽低，物联网设备还经常遇到网络环境不稳定的问题，尤其是在移动通信、卫星通信这样的场景下。比如共享单车，如果用户已经锁车的这个消息，不能可靠地上传到服务器，那么计费就会出现错误，结果引起用户的抱怨。这样怎么应对呢？</p><p>这个问题产生的背景就是不稳定的通信条件，所以 MQTT 协议设计了 3 种不同的 QoS （Quality of Service，服务质量）级别。你可以根据场景灵活选择，在不同环境下保证通信是可靠的。</p><p>这 3 种级别分别是：</p><ol><li>QoS 0，表示消息<strong>最多</strong>收到一次，即消息可能丢失，但是不会重复。</li><li>QoS 1，表示消息<strong>至少</strong>收到一次，即消息保证送达，但是可能重复。</li><li>QoS 2，表示消息<strong>只会</strong>收到一次，即消息有且只有一次。</li></ol><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage63d163ced1e04d756yy9ae89c3c81c8ac9d1.c5c62499.jpg" alt=""/></p><p>我用一张图展示了它们各自的特点。可以看到，QoS 0 和 QoS 1 的流程相对比较简单；而 QoS 2 为了保证有且只有一次的可靠传输，流程相对复杂些。</p><p>正常情况下，QoS 2有PUBLISH、PUBREC、PUBREL 和 PUBCOMP 4 次交互。</p><p>至于“不正常的情况”，发送方就需要重复发送消息。比如一段时间内没有收到 PUBREC 消息，就需要再次发送PUBLISH消息。不过要注意，这时要把消息中的 “重复”标识设置为1，以便接收方能正确处理。同样地，如果没有收到 PUBCOMP 消息，发送方就需要再次发送PUBREL消息。</p><p>剖析到这里，MQTT协议本身的主要特性我就介绍完了，我们已经为在实战篇编写 MQTT 的相关通信代码做好了准备。但是，我还想跟你补充一个跟生产环境有关的知识点，那就是<strong>数据安全传输</strong>。</p><h3 id="安全传输"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/04.进阶篇/03#安全传输"><span class="icon icon-link"></span></a>安全传输</h3><p>说到安全传输，首先我们需要验证Client是否有权限接入MQTT Broker。为了控制Client的接入，MQTT 提供了<strong>用户名/密码</strong>的机制。在建立连接过程中，它可以通过判断用户名和密码的正确性，来筛选有效连接请求。</p><p>但是光靠这个机制，还不能保证网络通信过程中的数据安全。因为在明文传输的方式下，不止设备数据，甚至用户名和密码都可能被其他人从网络上截获而导致泄漏，于是其他人就可以伪装成合法的设备发送数据。所以，我们还需要通信加密技术的支持。</p><p>MQTT 协议支持 <strong>SSL/TLS</strong> 加密通信方式。采用SSL/TLS加密之后，MQTT将转换为 MQTTS。这有点类似于 HTTP 和 HTTPS 的关系。</p><p>我们只要将前面测试的命令修改一下，将 “mqtt://” 改为 “mqtts://”，端口改为 8883，就可以用SSL/TLS 加密通信方式连接到 Eclipse 提供的开放 Broker。但是我最近发现，它的SSL证书已经过期了，因此连接会失败。（你在学习这一讲的时候，可以再试试，万一又更新了呢？）</p><p>所以，我再提供另一个方式，供你测试使用。</p><p>我们输入“mqtts://test.mosquitto.org:8883”，把开放 Broker 切换到<a target="_blank" rel="noopener noreferrer" href="https://test.mosquitto.org/">这个链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，从链接中下载一个<a target="_blank" rel="noopener noreferrer" href="https://test.mosquitto.org/ssl/mosquitto.org.crt">客户端证书<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，然后通过下面的命令订阅主题消息：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">hbmqtt_sub --url mqtts://test.mosquitto.org:8883 -t /geektime/iot --ca-file ~/Downloads/mosquitto.org.crt</span></div></pre></div><p>接着，我们再通过下面的命令测试发布消息：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">hbmqtt_pub --url mqtts://test.mosquitto.org:8883 -t /geektime/iot -m Hello,World! --ca-file ~/Downloads/mosquitto.org.crt</span></div></pre></div><p>最后在运行hbmqtt_sub命令的终端，就可以看到 Hello,World! 的消息：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimageb030b04f873277f9dba5bfb7e9ff85d17630.9c5404e0.png" alt=""/></p><h2 id="小结"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/04.进阶篇/03#小结"><span class="icon icon-link"></span></a>小结</h2><p>总结一下，在这一讲中，我带你体验了使用MQTT协议的通信过程，同时也为你介绍了 MQTT 协议的几个特点。</p><ol><li>MQTT协议的生态很好。比如，MQTT 协议的代码实现非常丰富，C 语言的有 Mosquitto，Python 语言有 Eclipse hbmqtt，而且有商业公司在运营相关软件解决方案。这表明 MQTT 协议很成熟。</li><li>MQTT协议采用了适合物联网应用场景的发布-订阅模式。当然，我也提到了MQTT 5.0 中同样增加了请求-响应模式，便于部分场景中的开发使用。</li><li>MQTT 协议采用二进制的消息内容编码格式，协议很精简，协议交互也简单，这些特点保证了网络传输流量很小。所以客户端（包括发布者和订阅者角色）的代码实现可以短小精悍，比如 C 语言的实现大概只占30KB 的存储空间，Java 语言也只需要 100KB 左右大小的代码体积。</li><li>MQTT 协议在设计上考虑了很多物联网设备的低功耗需求，比如Keepalive机制中精简的PINGREQ 和 PINGRESP 这两种消息类型，还有 MQTT 5.0 中新增加的重复主题特性。这也再次印证了MQTT的定位非常明确，那就是专注于物联网场景。</li><li>MQTT 在消息的可靠传输和安全性上，也有完整的支持，可以说“简约而不简单”。</li></ol><p>因此，在你为物联网系统选择网络协议时，MQTT可以作为重点考察对象。在实战篇的动手实验中，我们将使用MQTT协议传输设备数据，相信你已经做好了准备。</p><h2 id="思考题"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/04.进阶篇/03#思考题"><span class="icon icon-link"></span></a>思考题</h2><p>最后，我想给你留一个实践作业和一道思考题。</p><p>在介绍 QoS 等级的时候，我没有结合网络抓包来说明消息的交互过程。所以，我想请你在课后使用 Wireshark 工具，实际分析一下各个 QoS 级别的数据包类型。</p><p>同时，也请你思考一下，如果Client 发布消息时选择的 QoS 等级是1 ，而订阅者在订阅这个主题消息时选择的QoS等级是2 ，这种情况下 Broker会怎么处理呢？</p><p>欢迎你在留言区写一写你的实践和思考的结果，也欢迎你将这一讲分享给你的朋友一起交流学习。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/物联网开发实战/04.进阶篇/03.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/23 21:58:31</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-other/umi.js"></script>
  </body>
</html>
