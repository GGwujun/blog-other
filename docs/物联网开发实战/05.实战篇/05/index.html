<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-other/umi.css" />
    <script>
      window.routerBase = "/blog-other";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>20 | 智能语音：好玩的语音控制是怎么实现的？ - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/物联网开发实战/05.实战篇/05" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-other/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>前端开发<ul><li><a href="/blog-other/说透低代码">说透低代码</a></li><li><a href="/blog-other/反爬虫兵法演绎20讲">反爬虫兵法演绎20讲</a></li></ul></span><span>产品与用户体验<ul><li><a href="/blog-other/大厂广告产品心法">大厂广告产品心法</a></li></ul></span><span>面试<ul><li><a href="/blog-other/技术面试官识人手册">技术面试官识人手册</a></li><li><a href="/blog-other/面试现场">面试现场</a></li></ul></span><span>杂谈<ul><li><a href="/blog-other/乔新亮的cto成长复盘">乔新亮的cto成长复盘</a></li><li><a href="/blog-other/互联网人的英语私教课">互联网人的英语私教课</a></li><li><a href="/blog-other/从0开始学游戏开发">从0开始学游戏开发</a></li><li><a href="/blog-other/全栈工程师修炼指南">全栈工程师修炼指南</a></li><li><a href="/blog-other/手机摄影">手机摄影</a></li><li><a aria-current="page" class="active" href="/blog-other/物联网开发实战">物联网开发实战</a></li><li><a href="/blog-other/白话法律42讲">白话法律42讲</a></li><li><a href="/blog-other/说透5g">说透5g</a></li><li><a href="/blog-other/超级访谈对话张雪峰">超级访谈对话张雪峰</a></li><li><a href="/blog-other/零基础实战机器学习">零基础实战机器学习</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-other/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>前端开发<ul><li><a href="/blog-other/说透低代码">说透低代码</a></li><li><a href="/blog-other/反爬虫兵法演绎20讲">反爬虫兵法演绎20讲</a></li></ul></li><li>产品与用户体验<ul><li><a href="/blog-other/大厂广告产品心法">大厂广告产品心法</a></li></ul></li><li>面试<ul><li><a href="/blog-other/技术面试官识人手册">技术面试官识人手册</a></li><li><a href="/blog-other/面试现场">面试现场</a></li></ul></li><li>杂谈<ul><li><a href="/blog-other/乔新亮的cto成长复盘">乔新亮的cto成长复盘</a></li><li><a href="/blog-other/互联网人的英语私教课">互联网人的英语私教课</a></li><li><a href="/blog-other/从0开始学游戏开发">从0开始学游戏开发</a></li><li><a href="/blog-other/全栈工程师修炼指南">全栈工程师修炼指南</a></li><li><a href="/blog-other/手机摄影">手机摄影</a></li><li><a aria-current="page" class="active" href="/blog-other/物联网开发实战">物联网开发实战</a></li><li><a href="/blog-other/白话法律42讲">白话法律42讲</a></li><li><a href="/blog-other/说透5g">说透5g</a></li><li><a href="/blog-other/超级访谈对话张雪峰">超级访谈对话张雪峰</a></li><li><a href="/blog-other/零基础实战机器学习">零基础实战机器学习</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-other/物联网开发实战">物联网开发实战</a></li><li><a href="/blog-other/物联网开发实战/01.2022特别加更">01.2022特别加更</a><ul><li><a href="/blog-other/物联网开发实战/01.2022特别加更/01"><span>引子｜RISC-V：物联网领域值得关注的芯片趋势是什么？</span></a></li><li><a href="/blog-other/物联网开发实战/01.2022特别加更/02"><span>实战一｜嵌入式开发：如何使用C语言开发智能电灯？</span></a></li><li><a href="/blog-other/物联网开发实战/01.2022特别加更/03"><span>实战二｜MQTT开发：如何实现联网控制？</span></a></li><li><a href="/blog-other/物联网开发实战/01.2022特别加更/04"><span>假期快乐｜这是一份暂时停更的声明</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/02.开篇词">02.开篇词</a><ul><li><a href="/blog-other/物联网开发实战/02.开篇词/01"><span>开篇词 | 物联网这个趋势，你不应该错过</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/03.基础篇">03.基础篇</a><ul><li><a href="/blog-other/物联网开发实战/03.基础篇/01"><span>01 | 入门介绍：如何定义物联网？</span></a></li><li><a href="/blog-other/物联网开发实战/03.基础篇/02"><span>02 | 通信技术：设备接入网络的方式有哪些？</span></a></li><li><a href="/blog-other/物联网开发实战/03.基础篇/03"><span>03 | 网络协议：设备使用什么语言与互联网对话？</span></a></li><li><a href="/blog-other/物联网开发实战/03.基础篇/04"><span>04 | 数据分析：数据的价值有哪些？</span></a></li><li><a href="/blog-other/物联网开发实战/03.基础篇/05"><span>05 | 系统实例：怎样设计一个简易物联网系统？</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/04.进阶篇">04.进阶篇</a><ul><li><a href="/blog-other/物联网开发实战/04.进阶篇/01"><span>06 | 物模型：如何定义智能电灯？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/02"><span>07 | 零配置组网：设备如何发现彼此？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/03"><span>08 | MQTT：在实践中掌握一个通信协议</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/04"><span>09 | 边缘中心：物联网网关有多重要？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/05"><span>10 | 数据处理框架：批处理还是流处理？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/06"><span>11 | 数据存储：物联网中的数据库有哪些？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/07"><span>12 | IoT Hub：面对海量设备如何打造高性能设备接入层？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/08"><span>13 | 隐私：在实践中如何保护用户隐私？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/09"><span>14 | 安全：物联网平台如何应对安全风险？</span></a></li><li><a href="/blog-other/物联网开发实战/04.进阶篇/10"><span>15 | 平台：智能家居开源平台的生态是怎样的？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-other/物联网开发实战/05.实战篇">05.实战篇</a><ul><li><a href="/blog-other/物联网开发实战/05.实战篇/01"><span>16 | 实战准备：如何搭建硬件开发环境？</span></a></li><li><a href="/blog-other/物联网开发实战/05.实战篇/02"><span>17 | 远程控制：怎样打造联网的智能电灯？</span></a></li><li><a href="/blog-other/物联网开发实战/05.实战篇/03"><span>18 | 场景联动：智能电灯如何感知光线？（上）</span></a></li><li><a href="/blog-other/物联网开发实战/05.实战篇/04"><span>19 | 场景联动：智能电灯如何感知光线？（下）</span></a></li><li><a aria-current="page" class="active" href="/blog-other/物联网开发实战/05.实战篇/05"><span>20 | 智能语音：好玩的语音控制是怎么实现的？</span></a></li><li><a href="/blog-other/物联网开发实战/05.实战篇/06"><span>21 | 多传感器集成：浇花怎么实现自动化？</span></a></li><li><a href="/blog-other/物联网开发实战/05.实战篇/07"><span>22 | 掌控数据：家里的数据可以怎么利用？</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/06.结束语">06.结束语</a><ul><li><a href="/blog-other/物联网开发实战/06.结束语/01"><span>结束语 | 永远做一个具有极客精神的人</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/07.测试题">07.测试题</a><ul><li><a href="/blog-other/物联网开发实战/07.测试题/01"><span>结课测试 | 这些物联网的问题，你都掌握了吗？</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/08.加餐">08.加餐</a><ul><li><a href="/blog-other/物联网开发实战/08.加餐/01"><span>加餐一 | 这5本关于物联网的好书，值得一读</span></a></li><li><a href="/blog-other/物联网开发实战/08.加餐/02"><span>加餐二 | 行业应用：物联网的发展将如何重塑我们的生活？</span></a></li><li><a href="/blog-other/物联网开发实战/08.加餐/03"><span>加餐三 | 行业应用：物联网的发展将如何升级第一、第二产业？</span></a></li><li><a href="/blog-other/物联网开发实战/08.加餐/04"><span>加餐四 | 5G技术将如何推动物联网的发展？</span></a></li><li><a href="/blog-other/物联网开发实战/08.加餐/05"><span>加餐五 | 投身物联网行业，如何做好职业规划？</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/09.用户故事">09.用户故事</a><ul><li><a href="/blog-other/物联网开发实战/09.用户故事/01"><span>用户故事 | 让野蛮生长成为职业发展的助推剂</span></a></li><li><a href="/blog-other/物联网开发实战/09.用户故事/02"><span>用户故事 | 转战物联网，我相信天道酬勤</span></a></li></ul></li><li><a href="/blog-other/物联网开发实战/summary">物联网开发实战</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="智能音箱的技术架构" data-depth="2"><a href="/blog-other/物联网开发实战/05.实战篇/05#智能音箱的技术架构"><span>智能音箱的技术架构</span></a></li><li title="拾音" data-depth="3"><a href="/blog-other/物联网开发实战/05.实战篇/05#拾音"><span>拾音</span></a></li><li title="前端语音信号处理" data-depth="3"><a href="/blog-other/物联网开发实战/05.实战篇/05#前端语音信号处理"><span>前端语音信号处理</span></a></li><li title="语音唤醒" data-depth="3"><a href="/blog-other/物联网开发实战/05.实战篇/05#语音唤醒"><span>语音唤醒</span></a></li><li title="语音识别" data-depth="3"><a href="/blog-other/物联网开发实战/05.实战篇/05#语音识别"><span>语音识别</span></a></li><li title="自然语言理解" data-depth="3"><a href="/blog-other/物联网开发实战/05.实战篇/05#自然语言理解"><span>自然语言理解</span></a></li><li title="技能" data-depth="3"><a href="/blog-other/物联网开发实战/05.实战篇/05#技能"><span>技能</span></a></li><li title="自然语言生成" data-depth="3"><a href="/blog-other/物联网开发实战/05.实战篇/05#自然语言生成"><span>自然语言生成</span></a></li><li title="语音合成" data-depth="3"><a href="/blog-other/物联网开发实战/05.实战篇/05#语音合成"><span>语音合成</span></a></li><li title="智能音箱的开发" data-depth="2"><a href="/blog-other/物联网开发实战/05.实战篇/05#智能音箱的开发"><span>智能音箱的开发</span></a></li><li title="麦克风阵列" data-depth="3"><a href="/blog-other/物联网开发实战/05.实战篇/05#麦克风阵列"><span>麦克风阵列</span></a></li><li title="语音唤醒" data-depth="3"><a href="/blog-other/物联网开发实战/05.实战篇/05#语音唤醒-1"><span>语音唤醒</span></a></li><li title="语音识别" data-depth="3"><a href="/blog-other/物联网开发实战/05.实战篇/05#语音识别-1"><span>语音识别</span></a></li><li title="语音合成" data-depth="3"><a href="/blog-other/物联网开发实战/05.实战篇/05#语音合成-1"><span>语音合成</span></a></li><li title="通过智能音箱控制电灯" data-depth="2"><a href="/blog-other/物联网开发实战/05.实战篇/05#通过智能音箱控制电灯"><span>通过智能音箱控制电灯</span></a></li><li title="小结" data-depth="2"><a href="/blog-other/物联网开发实战/05.实战篇/05#小结"><span>小结</span></a></li><li title="思考题" data-depth="2"><a href="/blog-other/物联网开发实战/05.实战篇/05#思考题"><span>思考题</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="20--智能语音好玩的语音控制是怎么实现的"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#20--智能语音好玩的语音控制是怎么实现的"><span class="icon icon-link"></span></a>20 | 智能语音：好玩的语音控制是怎么实现的？</h1><p>你好，我是郭朝斌。</p><p>实战篇的前几讲，我们打造了联网智能电灯，并实现了跟光照传感器的场景联动。今天我们来玩一个更酷的，智能音箱。</p><p>智能音箱为我们提供了一种更加自然的交互方式，所以亚马逊的Echo产品一经问世，就迅速流行起来。与智能家居结合之后，它更是引起了行业巨头的注意，被认为是很有发展潜力的用户入口和平台级产品。</p><p>我们先不论智能音箱最终到底能不能发展成智能家居的平台级产品，至少这波热潮已经极大地推动了相关技术的发展，而且用户覆盖率也有了很大的提升。</p><p>这一讲我就为你介绍一下智能音箱的语音控制是怎么实现的，并且带你动手完成开发过程（如有需要，你可以根据<a target="_blank" rel="noopener noreferrer" href="https://shimo.im/sheets/D3VVPdwcYRhhQRXh/MODOC">这份文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>自行采购相关硬件）。</p><h2 id="智能音箱的技术架构"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#智能音箱的技术架构"><span class="icon icon-link"></span></a>智能音箱的技术架构</h2><p>智能音箱主要涉及<strong>拾音</strong>、<strong>前端信号处理</strong>、<strong>语音识别</strong>、<strong>自然语言处理</strong>和<strong>语音合成</strong>等技术，现在一些产品甚至提供了声纹识别技术。</p><p>当然，智能音箱最重要的是提供各种功能，完成一些任务，比如控制电灯的开和关，这被称为<strong>技能</strong>。</p><p>整体的技术架构如下图所示：</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage2af52a01c24619120c4c464d975bb0e8e4f5.16174d28.jpg" alt=""/></p><p>接下来，我会逐个讲解这些技术组成。</p><h3 id="拾音"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#拾音"><span class="icon icon-link"></span></a>拾音</h3><p>拾音，就是通过<strong>麦克风</strong>获取你的语音。</p><p>我们都用微信发送过语音消息，手机就是通过麦克风来获取你说的话的，这么说起来，拾音好像很简单。但是，智能音箱应对的环境要更复杂，因为用户可能在比较远的地方下达语音指令。</p><p>因此，智能音箱上一般采用<strong>麦克风阵列</strong>（Mic Array），也就是按照一定规则排列的多个麦克风，比如下图展示的就是<a target="_blank" rel="noopener noreferrer" href="https://zh.ifixit.com/Teardown/Amazon+Echo+Teardown/33953">Amazon Echo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>由7个麦克风组成的阵列（绿色圆圈部分）。</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage83f0831c5e67ddb3cbdeda86c496317b8df0.ee7b53d0.jpg" alt=""/></p><h3 id="前端语音信号处理"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#前端语音信号处理"><span class="icon icon-link"></span></a>前端语音信号处理</h3><p>在收集到声音信号后，还需要进行前端语音信号处理。只有经过处理，智能音箱才能获取到相对干净的语音信号，也才能提高后面的语音识别的准确率。</p><p>这些处理技术包括回声消除（Acoustic Echo Cancellaction, AEC）、噪音抑制（Noise Suppression，NS）、语音检测（Voice Activity Detection，VAD）、声源定位（Direction of Arrival estimation，DOA）、波束成型（Beamforming）和混响消除（Speech Dereverberation）等。</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimageaa71aaffc6862eab6a9af9cb27ec6dacd971.afc16ef8.jpg" alt=""/></p><h3 id="语音唤醒"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#语音唤醒"><span class="icon icon-link"></span></a>语音唤醒</h3><p>语音唤醒（Keyword Spotting，KWS），就是通过特定的<strong>唤醒词</strong>来激活智能音箱，以便进行后续的语音交互任务。这样做一方面可以保护用户的隐私，因为只有唤醒后，音箱才收集和识别用户的语音信息，另一方面也可以简化语音的识别和理解，比如小米智能音箱的“小爱同学”就是这样的唤醒词。</p><h3 id="语音识别"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#语音识别"><span class="icon icon-link"></span></a>语音识别</h3><p>语音识别（Automatic Speech Recognition，ASR），主要完成的任务是将语音转换成文本，所以也被称为STT（Speech to Text）。</p><h3 id="自然语言理解"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#自然语言理解"><span class="icon icon-link"></span></a>自然语言理解</h3><p>自然语言理解（Natural Language Understanding，NLU），是对语音识别生成的文本进行处理，识别用户的意图，并生产结构化的数据。</p><p>当然，以现在的人工智能发展水平来看，自然语言理解还有很长的路要走。这也是我们常发现智能音箱不够“智能”的原因。</p><h3 id="技能"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#技能"><span class="icon icon-link"></span></a>技能</h3><p>技能（Skills）一般要借助后端云平台的强大能力，云平台可以提供知识图谱、家居设备远程控制和音乐等音频资源等能力。</p><h3 id="自然语言生成"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#自然语言生成"><span class="icon icon-link"></span></a>自然语言生成</h3><p>自然语言生成（Natural Language Generation，NLG），就是将各种技能的响应结果组织成文本语言。比如当你询问天气时，根据获取的天气状况和温度等信息生成“北京今天晴，最高温度5°，最低温度-6°”这样的语句。自然语言生成和自然语言理解都属于<strong>自然语言处理</strong>（Natural Language Processing，NLP）的范畴。</p><h3 id="语音合成"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#语音合成"><span class="icon icon-link"></span></a>语音合成</h3><p>语音合成（Speech Synthesis），就是将自然语言生成的文本转换为语音的形式，提供给智能音箱播放出来，给人的感觉就像和音箱在对话。因此，这个过程也叫做TTS（Text to Speech）。</p><h2 id="智能音箱的开发"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#智能音箱的开发"><span class="icon icon-link"></span></a>智能音箱的开发</h2><p>了解完智能音箱的基本技术构成，下面我们就基于树莓派开发一个自己的简易智能音箱吧。</p><p>首先，我需要说明一下树莓派的系统。为什么呢？因为在<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/320675">第15讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中，我们安装了Gladys Assistant系统镜像，而这个系统Raspbian是基于Debian buster版本的，一些语音识别开源库对于buster的支持并不够好。</p><p>所以，如果你的树莓派是Raspberry Pi 3系列，强烈建议你把系统镜像切换成<strong>Debian stretch</strong>版本。通过<a target="_blank" rel="noopener noreferrer" href="https://downloads.raspberrypi.org/raspbian/images/raspbian-2019-04-09/">这个链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>就可以下载基于Debian stretch版本的Raspbian镜像文件压缩包，安装还是使用Etcher工具，你可以回头看一下第15讲的介绍。</p><p>至于树莓派Raspberry Pi 4系列，因为官方系统Raspbian只有buster版本支持，所以我们还是继续基于第15讲的系统开发。</p><h3 id="麦克风阵列"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#麦克风阵列"><span class="icon icon-link"></span></a>麦克风阵列</h3><p>麦克风阵列我使用的是<strong>ReSpeaker 2-Mics Pi HAT</strong>，它的2个麦克风分布在模组的两边。我们现在来配置一下，让它可以在树莓派上正常工作。</p><p>你可以通过下面的命令安装它的驱动程序。首先，你最好切换一下树莓派的软件安装源，将它切换到国内的腾讯云安装源，这样下载安装的速度比较快。运行下面的命令修改配置文件：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ sudo vim /etc/apt/sources.list</span></div></pre></div><p>将文件修改为下面的内容：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">deb https://mirrors.cloud.tencent.com/raspbian/raspbian/ buster main contrib non-free rpi</span></div><div class="token-line"><span class="token plain">    # Uncomment line below then &#x27;apt-get update&#x27; to enable &#x27;apt-get source&#x27;</span></div><div class="token-line"><span class="token plain">    deb-src https://mirrors.cloud.tencent.com/raspbian/raspbian/ buster main contrib non-free rpi</span></div></pre></div><p>修改另一个软件安装源的配置文件，命令如下所示：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ sudo vim /etc/apt/sources.list.d/raspi.list</span></div></pre></div><p>修改后的文件内容如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">deb https://mirrors.cloud.tencent.com/raspberrypi/ buster main</span></div><div class="token-line"><span class="token plain">    # Uncomment line below then &#x27;apt-get update&#x27; to enable &#x27;apt-get source&#x27;</span></div><div class="token-line"><span class="token plain">    deb-src https://mirrors.cloud.tencent.com/raspberrypi/ buster main</span></div></pre></div><p>然后，你需要运行下面的命令更新安装源：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ sudo apt-get clean all</span></div><div class="token-line"><span class="token plain">    $ sudo apt-get update</span></div></pre></div><p>现在，你可以运行下面命令安装麦克风阵列的驱动程序。因为这个驱动依赖的wm8960 编解码器没有包含在树莓派系统的内核里面，需要重新加载内核，编译驱动，所以整个过程比较久。在等待的过程中，你可以先阅读这一讲的其他部分。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ sudo apt-get install git</span></div><div class="token-line"><span class="token plain">    $ git clone --depth=1 https://github.com/respeaker/seeed-voicecard</span></div><div class="token-line"><span class="token plain">    $ cd seeed-voicecard</span></div><div class="token-line"><span class="token plain">    $ sudo ./install.sh</span></div><div class="token-line"><span class="token plain">    $ sudo reboot</span></div></pre></div><p>树莓派重启之后，你可以在树莓派终端输入下面的命令，查看音频的输入和输出设备是否正常工作。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ arecord -l</span></div><div class="token-line"><span class="token plain">    $ aplay -l</span></div></pre></div><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimageef54ef1645e03ef2ba2e2c78edf6a9804e54.b65e74e7.png" alt=""/></p><p>如果一切正常，我们就可以测试录音和播放功能了。在ReSpeaker 2-Mics Pi HAT的耳机插口上插入耳机或者扬声器，运行下面的命令，并说几句话。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ arecord -d 5 test.wav</span></div><div class="token-line"><span class="token plain">    $ aplay test.wav</span></div></pre></div><p>另外，你也可以通过软件<strong>AlsaMixer</strong>（命令alsamixer）来配置声音设置和调整音量，左、右箭头键用于选择通道或设备，向上、向下箭头控制当前所选设备的音量。退出程序使用ALT + Q，或者按Esc键。</p><p>为了简化开发，也考虑到麦克风硬件的限制，我们这里就先不关注前端语音信号处理的相关开发了。接下来，我们直接来到实现语音唤醒的环节。</p><h3 id="语音唤醒-1"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#语音唤醒-1"><span class="icon icon-link"></span></a>语音唤醒</h3><p>为了实现语音唤醒，我们需要选择一个轻量级的、可以在树莓派上运行的唤醒词监测器软件。</p><p>你可能首先想到的是<strong>Snowboy</strong>，没错，它确实是一个非常流行的工具。不过，Snowboy团队在2020年初的时候宣布，2020年12月31日会停止提供服务，所以我们只能寻找替代方案。</p><p>我选择的是<a target="_blank" rel="noopener noreferrer" href="https://github.com/MycroftAI/mycroft-precise">Mycroft Precise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，它是一个基于RNN神经网络的语音唤醒工具。</p><p>接下来，我们在树莓派安装Mycroft Precise。因为需要训练唤醒词模型，我们需要基于源代码来编译、安装。</p><p>首先，我们通过git命令把Mycroft Precise的源代码下载到树莓派的/home/pi目录：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ cd ~</span></div><div class="token-line"><span class="token plain">    $ git clone https://github.com/mycroftai/mycroft-precise</span></div><div class="token-line"><span class="token plain">    $ cd mycroft-precise</span></div></pre></div><p>在安装之前，把pypi的安装源修改到清华数据源，可以获得更快的下载速度。我们打开目录中的setup.sh文件：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ vim setup.sh</span></div></pre></div><p>将文件中的这行内容：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">extra-index-url=https://www.piwheels.org/simple</span></div></pre></div><p>替换成下面的内容：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">index-url=https://pypi.tuna.tsinghua.edu.cn/simple</span></div><div class="token-line"><span class="token plain">    extra-index-url=https://www.piwheels.org/simple</span></div></pre></div><p>然后，我们运行它自带的安装脚本，开始编译和安装。中间如果执行中断，可以重新执行这个命令，继续安装过程。（提示：有些ARM平台的库只有piwheels上有，所以这些库安装时速度还是很慢。这种情况下，可以电脑上使用下载工具获取这个模块的安装文件，然后上传到树莓派上，手动安装。）</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ ./setup.sh</span></div></pre></div><p>安装完成后，我们开始使用Mycroft Precise来训练一个唤醒词模型，唤醒词可以根据喜好来选择，比如“极客时间”。</p><p>我们需要先激活Python的虚拟环境，因为Mycroft Precise在安装过程中创建了这个虚拟环境。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ source .venv/bin/activate</span></div></pre></div><p>接下来，我们通过工具precise-collect来收集语音模型训练的声音素材，运行后，根据提示录制12段声音。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ precise-collect</span></div><div class="token-line"><span class="token plain">    Audio name (Ex. recording-##): geektime.##</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    Press space to record (esc to exit)...</span></div><div class="token-line"><span class="token plain">    Recording...</span></div><div class="token-line"><span class="token plain">    Saved as geektime-00.wav</span></div><div class="token-line"><span class="token plain">    Press space to record (esc to exit)...</span></div></pre></div><p>然后，我们需要将这些声音随机分为两份，一份是训练样本，包括8个声音文件，另一份是测试样本，包括4个声音文件，并且把这两份样本分别放到geektime/wake-word/和/geektime/test/wake-word/这两个目录下面。</p><p>接着，我们执行下面的命令，生成神经网络模型geektime.net：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ precise-train -e 60 geektime.net geektime/</span></div></pre></div><p>最后，我们还需要将geektime.net的模型格式做一下转换，将它从Keras模型格式改为TensorFlow模型格式，因为TensorFlow模型更加通用。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ precise-convert geektime.net</span></div></pre></div><p>执行完成之后，我们会得到两个文件：</p><ol><li>geektime.pb，TensorFlow模型文件</li><li>geektime.pb.params，包含Mycroft Precise在处理音频时需要的一些参数信息。</li></ol><p>当然，为了提高模型的准确性，我们还可以使用precise-train-incremental工具来增加负样本，重新训练刚才的模型。如果环境复杂的话，你可以尝试一下。</p><p>然后，我们可以运行一段代码来测试这个唤醒词模型。不过，因为portaudio这个库在树莓派上运行有问题，我们需要先修复一下portaudio库。你可以运行下面的命令：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ sudo apt-get remove libportaudio2</span></div><div class="token-line"><span class="token plain">    $ sudo apt-get install libasound2-dev</span></div><div class="token-line"><span class="token plain">    $ git clone -b alsapatch https://github.com/gglockner/portaudio</span></div><div class="token-line"><span class="token plain">    $ cd portaudio</span></div><div class="token-line"><span class="token plain">    $ ./configure &amp;&amp; make</span></div><div class="token-line"><span class="token plain">    $ sudo make install</span></div><div class="token-line"><span class="token plain">    $ sudo ldconfig</span></div></pre></div><p>测试程序的代码如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain"># File：kwsdemo.py</span></div><div class="token-line"><span class="token plain">    #!/usr/bin/env python3</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    from precise_runner import PreciseEngine, PreciseRunner</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    engine = PreciseEngine(&#x27;precise-engine/precise-engine&#x27;, &#x27;geektime.pb&#x27;)</span></div><div class="token-line"><span class="token plain">    runner = PreciseRunner(engine, on_activation=lambda: print(&#x27;hello&#x27;))</span></div><div class="token-line"><span class="token plain">    runner.start()</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    # Sleep forever</span></div><div class="token-line"><span class="token plain">    from time import sleep</span></div><div class="token-line"><span class="token plain">    while True:</span></div><div class="token-line"><span class="token plain">        sleep(10)</span></div></pre></div><p>现在，我们把kwsdemo.py文件，还有两个geektime.pb模型相关的文件，都上传到树莓派的Mycroft Precise目录下，然后运行kwsdemo.py文件，说出“极客时间”几个字，就会看到终端显示出“hello”这个单词。</p><h3 id="语音识别-1"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#语音识别-1"><span class="icon icon-link"></span></a>语音识别</h3><p>对于语音识别，我们直接采用腾讯云提供的语音识别SDK来完成（你需要提前在腾讯云控制台开通这个服务）。它会将语音发送到云端，由云端服务器计算出文本信息。你可以通过下面命令来安装：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ pip3 install tencentcloud-sdk-python</span></div></pre></div><p>在开始使用之前，你需要访问<a target="_blank" rel="noopener noreferrer" href="https://console.cloud.tencent.com/cam/capi">这个链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>创建一个密钥，然后记录下SecretId和SecretKey的信息。</p><p>你可以参考下面的代码，来完成一个录音文件的识别。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">from tencentcloud.common import credential</span></div><div class="token-line"><span class="token plain">    from tencentcloud.common.profile.client_profile import ClientProfile</span></div><div class="token-line"><span class="token plain">    from tencentcloud.common.profile.http_profile import HttpProfile</span></div><div class="token-line"><span class="token plain">    from tencentcloud.common.exception.tencent_cloud_sdk_exception import TencentCloudSDKException </span></div><div class="token-line"><span class="token plain">    from tencentcloud.asr.v20190614 import asr_client, models </span></div><div class="token-line"><span class="token plain">    import base64</span></div><div class="token-line"><span class="token plain">    import io </span></div><div class="token-line"><span class="token plain">    import sys </span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    SECRET_ID = &quot;你的Secret ID&quot;</span></div><div class="token-line"><span class="token plain">    SECRET_KEY = &quot;你的Secret Key&quot;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    try: </span></div><div class="token-line"><span class="token plain">        cred = credential.Credential(SECRET_ID, SECRET_KEY) </span></div><div class="token-line"><span class="token plain">        httpProfile = HttpProfile()</span></div><div class="token-line"><span class="token plain">        httpProfile.endpoint = &quot;asr.tencentcloudapi.com&quot;</span></div><div class="token-line"><span class="token plain">        clientProfile = ClientProfile()</span></div><div class="token-line"><span class="token plain">        clientProfile.httpProfile = httpProfile</span></div><div class="token-line"><span class="token plain">        clientProfile.signMethod = &quot;TC3-HMAC-SHA256&quot;  </span></div><div class="token-line"><span class="token plain">        client = asr_client.AsrClient(cred, &quot;ap-beijing&quot;, clientProfile) </span></div><div class="token-line"><span class="token plain">        #读取文件以及 base64</span></div><div class="token-line"><span class="token plain">        with open(&#x27;./geektime-00.wav&#x27;, &quot;rb&quot;) as f:</span></div><div class="token-line"><span class="token plain">            if sys.version_info[0] == 2:</span></div><div class="token-line"><span class="token plain">                content = base64.b64encode(f.read())</span></div><div class="token-line"><span class="token plain">            else:</span></div><div class="token-line"><span class="token plain">                content = base64.b64encode(f.read()).decode(&#x27;utf-8&#x27;)</span></div><div class="token-line"><span class="token plain">            f.close()</span></div><div class="token-line"><span class="token plain">        #发送请求</span></div><div class="token-line"><span class="token plain">        req = models.SentenceRecognitionRequest()</span></div><div class="token-line"><span class="token plain">        params = {&quot;ProjectId&quot;:0,&quot;SubServiceType&quot;:2,&quot;SourceType&quot;:1,&quot;UsrAudioKey&quot;:&quot;sessionid-geektime&quot;}</span></div><div class="token-line"><span class="token plain">        req._deserialize(params)</span></div><div class="token-line"><span class="token plain">        req.DataLen = len(content)</span></div><div class="token-line"><span class="token plain">        req.Data = content</span></div><div class="token-line"><span class="token plain">        req.EngSerViceType = &quot;16k_zh&quot;</span></div><div class="token-line"><span class="token plain">        req.VoiceFormat = &quot;wav&quot;</span></div><div class="token-line"><span class="token plain">        resp = client.SentenceRecognition(req) </span></div><div class="token-line"><span class="token plain">        print(resp.to_json_string()) </span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    except TencentCloudSDKException as err: </span></div><div class="token-line"><span class="token plain">        print(err)</span></div></pre></div><h3 id="语音合成-1"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#语音合成-1"><span class="icon icon-link"></span></a>语音合成</h3><p>接下来，我来介绍一下语音合成。</p><p>你可能会问，刚才介绍技术架构的时候，不是还讲了自然语言理解、技能和自然语言生成吗？这里怎么跳过去了呢？</p><p>首先，因为我们的任务很简单，只需要查询语音识别的文本中是否有“开”、“灯”，和“关”、“灯”就可以完成判断，所以自然语言理解直接判断字符串是否匹配即可。</p><p>其次，我们要实现控制智能电灯，这个技能我在后面会介绍。</p><p>最后，智能音箱只需要反馈执行开关灯的结果就可以，比如“我已经把灯打开了”或者“我已经把灯关了”，自然语言生成的部分按照固定的文本就可以了，不需要考虑动态生成的问题。</p><p>语音合成，就是我们希望把类似“我已经把灯关了”这样的文本信息，转换为音频，便于智能音箱播放出来。你可以基于离线的TTS引擎来实现，比如<a target="_blank" rel="noopener noreferrer" href="https://github.com/junzew/HanTTS">HanTTS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>这个项目。</p><p>当然，我们也可以使用腾讯云的语音合成服务（你需要提前在腾讯云控制台开通这个服务）。你可以参考下面的代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">import json</span></div><div class="token-line"><span class="token plain">    import base64</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    from tencentcloud.common import credential</span></div><div class="token-line"><span class="token plain">    from tencentcloud.common.profile.client_profile import ClientProfile</span></div><div class="token-line"><span class="token plain">    from tencentcloud.common.profile.http_profile import HttpProfile</span></div><div class="token-line"><span class="token plain">    from tencentcloud.common.exception.tencent_cloud_sdk_exception import TencentCloudSDKException</span></div><div class="token-line"><span class="token plain">    from tencentcloud.tts.v20190823 import tts_client, models</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    SECRET_ID = &quot;你的Secret ID&quot;</span></div><div class="token-line"><span class="token plain">    SECRET_KEY = &quot;你的Secret Key&quot;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    try: </span></div><div class="token-line"><span class="token plain">        cred = credential.Credential(SECRET_ID, SECRET_KEY) </span></div><div class="token-line"><span class="token plain">        httpProfile = HttpProfile()</span></div><div class="token-line"><span class="token plain">        httpProfile.endpoint = &quot;tts.tencentcloudapi.com&quot;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">        clientProfile = ClientProfile()</span></div><div class="token-line"><span class="token plain">        clientProfile.httpProfile = httpProfile</span></div><div class="token-line"><span class="token plain">        client = tts_client.TtsClient(cred, &quot;ap-beijing&quot;, clientProfile) </span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">        req = models.TextToVoiceRequest()</span></div><div class="token-line"><span class="token plain">        params = {</span></div><div class="token-line"><span class="token plain">            &quot;Text&quot;: &quot;我已经把灯关了&quot;,</span></div><div class="token-line"><span class="token plain">            &quot;SessionId&quot;: &quot;sessionid-geektime&quot;,</span></div><div class="token-line"><span class="token plain">            &quot;ModelType&quot;: 1,</span></div><div class="token-line"><span class="token plain">            &quot;ProjectId&quot;: 0,</span></div><div class="token-line"><span class="token plain">            &quot;VoiceType&quot;: 1002</span></div><div class="token-line"><span class="token plain">        }</span></div><div class="token-line"><span class="token plain">        req.from_json_string(json.dumps(params))</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">        resp = client.TextToVoice(req) </span></div><div class="token-line"><span class="token plain">        print(resp.to_json_string()) </span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">        if resp.Audio is not None:</span></div><div class="token-line"><span class="token plain">            audio = resp.Audio</span></div><div class="token-line"><span class="token plain">            data = base64.b64decode(audio)</span></div><div class="token-line"><span class="token plain">            wav_file = open(&quot;temp.wav&quot;, &quot;wb&quot;)</span></div><div class="token-line"><span class="token plain">            wav_file.write(data)</span></div><div class="token-line"><span class="token plain">            wav_file.close()</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    except TencentCloudSDKException as err: </span></div><div class="token-line"><span class="token plain">        print(err)</span></div></pre></div><h2 id="通过智能音箱控制电灯"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#通过智能音箱控制电灯"><span class="icon icon-link"></span></a>通过智能音箱控制电灯</h2><p>为了实现控制智能电灯的目的，我们需要借助物联网平台提供的开发接口。</p><p>首先，我们进入物联网开发平台，选择“智能家居”项目。</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage774977f96b642b6d5a077865b40904c59a49.a3497192.png" alt=""/></p><p>然后，点击左侧的“应用开发”，进入新建应用的界面，点击“新建应用”。</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage26d32630643ca6202249d3e4e7ba52e226d3.1b5f5a2b.png" alt=""/></p><p>完成后，点击应用列表里面的应用名称，进入应用的详情页面。你可以看到应用的SecretId和SecretKey信息。这里，你需要将下面“关联产品”中的智能电灯勾选上。只有建立关联，应用才可以控制这个设备。</p><p><img src="/blog-other/static/httpsstatic001geekbangorgresourceimage6fa26f93dbacdaa2d6573f6a183905d44da2.8299ef96.png" alt=""/></p><p>具体代码可以参考腾讯提供的开源实现，包括<a target="_blank" rel="noopener noreferrer" href="https://github.com/tencentyun/iot-link-ios/tree/master/Source/LinkApp">iOS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a target="_blank" rel="noopener noreferrer" href="https://github.com/tencentyun/iot-link-android/tree/master/app">Android<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a target="_blank" rel="noopener noreferrer" href="https://github.com/tencentyun/qcloud-iotexplorer-appdev-miniprogram-sdk-demo">小程序<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><p>不过，这种方式需要用户账号的登录认证，在树莓派上不太方便。还有一个方式就是基于物联网开发平台提供的通用API接口。其中的“<a target="_blank" rel="noopener noreferrer" href="https://cloud.tencent.com/document/product/1081/34973">设备远程控制<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>”接口可以满足我们的需求。</p><p>具体的控制方法，你可以参考下面的代码（注意，目前只支持ap-guangzhou区域）。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">import json</span></div><div class="token-line"><span class="token plain">    from led2.main import PRODUCT_ID</span></div><div class="token-line"><span class="token plain">    from tencentcloud.common import credential</span></div><div class="token-line"><span class="token plain">    from tencentcloud.common.profile.client_profile import ClientProfile</span></div><div class="token-line"><span class="token plain">    from tencentcloud.common.profile.http_profile import HttpProfile</span></div><div class="token-line"><span class="token plain">    from tencentcloud.common.exception.tencent_cloud_sdk_exception import TencentCloudSDKException</span></div><div class="token-line"><span class="token plain">    from tencentcloud.iotexplorer.v20190423 import iotexplorer_client, models</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    SECRET_ID = &quot;你的Secret ID&quot;</span></div><div class="token-line"><span class="token plain">    SECRET_KEY = &quot;你的Secret Key&quot;</span></div><div class="token-line"><span class="token plain">    PRODUCT_ID = &quot;你的ProductID&quot;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    def Light_control(state):</span></div><div class="token-line"><span class="token plain">        try: </span></div><div class="token-line"><span class="token plain">            cred = credential.Credential(SECRET_ID, SECRET_KEY) </span></div><div class="token-line"><span class="token plain">            httpProfile = HttpProfile()</span></div><div class="token-line"><span class="token plain">            httpProfile.endpoint = &quot;iotexplorer.tencentcloudapi.com&quot;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">            clientProfile = ClientProfile()</span></div><div class="token-line"><span class="token plain">            clientProfile.httpProfile = httpProfile</span></div><div class="token-line"><span class="token plain">            client = iotexplorer_client.IotexplorerClient(cred, &quot;ap-guangzhou&quot;, clientProfile) </span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">            req = models.ControlDeviceDataRequest()</span></div><div class="token-line"><span class="token plain">            data = {</span></div><div class="token-line"><span class="token plain">                &quot;power_switch&quot;: state</span></div><div class="token-line"><span class="token plain">            }</span></div><div class="token-line"><span class="token plain">            data_str = json.dumps(data)</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">            params = {</span></div><div class="token-line"><span class="token plain">                &quot;DeviceName&quot;: &quot;Led_1&quot;,</span></div><div class="token-line"><span class="token plain">                &quot;ProductId&quot;: PRODUCT_ID,</span></div><div class="token-line"><span class="token plain">                &quot;Data&quot;: data_str</span></div><div class="token-line"><span class="token plain">            }</span></div><div class="token-line"><span class="token plain">            req.from_json_string(json.dumps(params))</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">            resp = client.ControlDeviceData(req) </span></div><div class="token-line"><span class="token plain">            print(resp.to_json_string()) </span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">        except TencentCloudSDKException as err: </span></div><div class="token-line"><span class="token plain">            print(err) </span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    Light_control(0)</span></div></pre></div><h2 id="小结"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#小结"><span class="icon icon-link"></span></a>小结</h2><p>总结一下，在这一讲中，我介绍了智能音箱的技术架构，以及在树莓派上用于实现智能音箱的一些可选的技术方案，并且带你实现了语音控制智能电灯的目的。你需要重点关注的知识有：</p><ol><li>智能音箱的实现，需要前端音箱本体和后端云平台上一系列技术的支持。这些技术有前端的拾音、语音信号处理、语音唤醒和播音，以及后端的语音识别、自然语言理解、技能、自然语言生成和语音合成。</li><li>在树莓派的实现上，拾音可以选择使用麦克风阵列，因为基于麦克风阵列可以更好地实现前端语音信号处理，比如声源定位和波束成型等。</li><li>语言唤醒需要在智能音箱本体上实现，所以需要一些轻量级的识别引擎和训练好的唤醒词模型。之前比较流行的Snowboy将要停止服务，这里我选择了Mycroft Precise这个开源方案。</li><li>语音识别、自然语言理解、技能、自然语言生成和语音合成等任务适合基于云平台的能力来实现，因为云平台的计算能力更强，有更好的性能和准确度。</li></ol><p>智能音箱的技术也一直在发展，比如现在越来越多的智能音箱开始配备屏幕和摄像头，这为智能音箱引入了声音、UI和视觉等多模态的交互方式，相应地，这也给声纹识别、人脸识别和动作识别等技术带来了新的应用场景。我相信智能音箱未来的产品形态和功能还会不断地进化和发展。</p><h2 id="思考题"><a aria-hidden="true" tabindex="-1" href="/blog-other/物联网开发实战/05.实战篇/05#思考题"><span class="icon icon-link"></span></a>思考题</h2><p>最后，我给你留一个思考题吧。</p><p>在这一讲中，我们是通过物联网平台提供的API接口来控制智能电灯的。除了这种方式，你还能想到其他的方法来远程控制智能电灯吗？你能实现一个虚拟的联网开关，基于场景联动来控制智能电灯的开和关吗？</p><p>欢迎你在留言区写下你思考的结果，也欢迎你将这一讲分享给你的朋友，大家一起交流学习。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/物联网开发实战/05.实战篇/05.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/23 21:58:31</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-other/umi.js"></script>
  </body>
</html>
